<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIä¹°èœåŠ©æ‰‹</title>
    <style>
        /* iOS é£æ ¼é…è‰²æ–¹æ¡ˆ - å‚è€ƒæŒ‰é’®å‚è€ƒå›¾ */
        :root {
            /* ä¸»è‰²è°ƒ - æš–æ©™è‰² */
            --primary: #fab571;
            --primary-dark: #e89d4f;
            /* è¾…åŠ©è‰² - ç»¿è‰²ï¼ˆæˆåŠŸ/æ­£å‘ï¼‰ */
            --success: #34C759;
            --success-dark: #248A3D;
            /* å¼ºè°ƒè‰² - æ©™è‰²ï¼ˆæé†’/æ³¨æ„ï¼‰ */
            --accent: #FF9500;
            --accent-dark: #CC7700;
            /* ç‰¹æ®ŠåŠŸèƒ½ - ç´«è‰² */
            --purple: #AF52DE;
            --purple-dark: #8E3AAD;
            /* å±é™©è‰² - çº¢è‰²ï¼ˆåˆ é™¤/å±é™©æ“ä½œï¼‰ */
            --danger: #FF3B30;
            --danger-dark: #CC2F26;
            /* ä¸­æ€§è‰² */
            --bg: #F9FAFB;
            --card-bg: #FFFFFF;
            --text-dark: #1C1C1E;
            --text-muted: #8E8E93;
            --border: #E5E5EA;
            --shadow: rgba(0, 0, 0, 0.08);
            --shadow-hover: rgba(16, 185, 129, 0.15);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "PingFang SC", "Noto Sans SC", "Helvetica Neue", sans-serif;
            background: var(--bg);
            min-height: 100vh;
            padding: 0;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            color: var(--text-dark);
        }
        .container { max-width: 440px; margin: 0 auto; padding: 16px; }

        /* å¤´éƒ¨èƒŒæ™¯å›¾ */
        .hero-banner {
            width: calc(100% - 0px);
            height: 100px;
            margin: 0 auto 8px;
            border-radius: 16px;
            overflow: hidden;
            position: relative;
            display: flex;
            align-items: center;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            box-shadow: 0 4px 20px rgba(250, 181, 113, 0.25);
            padding: 0 20px;
        }
        .hero-banner::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.1);
        }
        .hero-content {
            position: relative;
            z-index: 1;
            text-align: left;
            width: 100%;
        }
        .hero-content h1 {
            font-size: 1.3rem;
            color: white;
            font-weight: 700;
        }
        .hero-content p {
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.8rem;
            margin-top: 4px;
        }

        /* å¤´éƒ¨ */
        .header {
            text-align: center;
            margin-bottom: 16px;
            padding: 0;
        }
        .header h1 {
            font-size: 1.5rem;
            color: var(--text-dark);
            font-weight: 700;
            letter-spacing: -0.5px;
        }
        .header p {
            color: var(--text-muted);
            font-size: 0.85rem;
            margin-top: 4px;
        }

        /* å¡ç‰‡ */
        .card {
            background: var(--card-bg);
            border-radius: 24px;
            padding: 20px;
            box-shadow: 0 4px 20px var(--shadow);
            margin-bottom: 12px;
        }

        /* è£…é¥°å›¾ç‰‡ */
        .decor-img {
            width: 100%;
            height: 80px;
            border-radius: 16px;
            overflow: hidden;
            margin-bottom: 16px;
        }
        .decor-img img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* è¡¨å•é¡¹ */
        .form-item { margin-bottom: 16px; }
        .form-item:last-child { margin-bottom: 0; }
        .label {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 10px;
            display: block;
        }
        .label .required { color: var(--accent); margin-left: 2px; }
        .label .hint { font-weight: 400; color: var(--text-muted); font-size: 0.8rem; margin-left: 4px; }

        /* åŠ å‡é€‰æ‹©å™¨ */
        .count-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; }
        .count-item {
            background: var(--bg);
            border-radius: 12px;
            padding: 8px 4px;
            text-align: center;
        }
        .count-label {
            font-size: 0.7rem;
            color: var(--text-muted);
            margin-bottom: 6px;
            font-weight: 500;
        }
        .count-controls { display: flex; align-items: center; justify-content: center; gap: 4px; }
        .count-btn {
            width: 24px;
            height: 24px;
            border: none;
            background: var(--bg);
            border-radius: 6px;
            font-size: 0.9rem;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.15s;
        }
        .count-btn:hover { background: var(--primary); color: white; }
        .count-btn:active { background: var(--primary-dark); transform: scale(0.95); }
        .count-btn:disabled { opacity: 0.3; cursor: not-allowed; }
        .count-value { font-weight: 600; font-size: 0.95rem; min-width: 20px; color: var(--accent); }

        /* ç¾é£Ÿç±»å‹å•é€‰ - èƒ¶å›Šå¼ */
        .type-tags { display: flex; flex-wrap: wrap; gap: 6px; }
        .type-tag {
            display: inline-flex;
            align-items: center;
            gap: 3px;
            padding: 6px 12px;
            background: var(--bg);
            border-radius: 16px;
            font-size: 0.85rem;
            color: var(--text-dark);
            cursor: pointer;
            border: none;
            transition: all 0.2s;
            font-weight: 500;
        }
        .type-tag:hover { background: #f5f5f5; }
        .type-tag.selected {
            background: #be831f;
            color: white;
            border-color: transparent;
            box-shadow: 0 2px 8px rgba(190, 131, 31, 0.3);
        }
        .type-tag input { display: none; }

        /* é£Ÿæè¾“å…¥ */
        .input-field {
            width: 100%;
            padding: 12px 14px;
            border: 1px solid var(--border);
            border-radius: 12px;
            font-size: 0.9rem;
            background: var(--bg);
            transition: all 0.2s;
            color: var(--text-dark);
        }
        .input-field:focus {
            outline: none;
            border-color: var(--primary);
            background: white;
        }
        .input-field::placeholder { color: var(--text-muted); }

        /* æäº¤æŒ‰é’® */
        .submit-btn {
            width: 100%;
            padding: 14px 24px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border: none;
            border-radius: 22px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 16px rgba(250, 181, 113, 0.3);
        }
        .submit-btn:hover { filter: brightness(1.1); transform: translateY(-2px); box-shadow: 0 6px 20px rgba(250, 181, 113, 0.4); }
        .submit-btn:active { transform: scale(0.98); }

        /* é”™è¯¯æç¤º */
        .error-msg {
            color: var(--danger);
            font-size: 0.8rem;
            margin-top: 6px;
            display: none;
        }
        .error-msg.show { display: block; }

        /* æ•°é‡é€‰é¡¹åŒºåŸŸ */
        .qty-section {
            display: none;
            margin-top: 16px;
            padding-top: 16px;
        }
        .qty-section.show { display: block; }
        .qty-section + .form-item { margin-top: 16px; }
        .form-item + .qty-section { margin-top: 16px; }
        .qty-title {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 10px;
            display: block;
        }
        .qty-title .required { color: var(--danger); margin-left: 2px; }
        .qty-placeholder {
            text-align: center;
            color: var(--text-muted);
            font-size: 0.85rem;
            padding: 20px;
            background: var(--bg);
            border-radius: 12px;
        }

        /* ç»“æœå¡ç‰‡ */
        .result-card { display: none; }
        .result-card.show { display: block; }
        .result-title {
            font-size: 1.1rem;
            color: var(--text-dark);
            text-align: center;
            margin-bottom: 16px;
            font-weight: 600;
        }
        .result-group { margin-bottom: 24px; }
        .result-group-title {
            font-size: 0.8rem;
            color: var(--text-dark);
            margin-bottom: 12px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            background: var(--bg);
            border-radius: 8px;
        }
        .recipe-card {
            background: white;
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 14px;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
            transition: all 0.2s;
            display: flex;
            gap: 12px;
            align-items: flex-start;
        }
        .recipe-card:hover {
            box-shadow: 0 4px 20px rgba(203, 172, 222, 0.25);
            transform: translateY(-2px);
        }
        .recipe-info { flex: 1; min-width: 0; }
        .recipe-img-placeholder {
            width: 70px;
            height: 70px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            overflow: hidden;
            border: 1px solid var(--border);
        }
        .recipe-img-placeholder img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .recipe-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 4px; }
        .recipe-name { font-size: 0.85rem; font-weight: 600; color: var(--text-dark); }
        .recipe-tag {
            background: var(--bg);
            color: var(--primary-dark);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.65rem;
        }
        .recipe-meta { font-size: 0.7rem; color: var(--text-muted); display: flex; gap: 10px; }
        .recipe-price {
            font-size: 0.8rem;
            color: var(--accent);
            font-weight: 600;
            margin-top: 6px;
        }
        .add-menu-btn {
            background: white;
            color: var(--primary);
            border: 1px solid var(--primary);
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 0.7rem;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
        }
        .add-menu-btn:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        .add-menu-btn.added {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        .add-menu-btn.added:hover {
            background: var(--primary-dark);
            border-color: var(--primary-dark);
        }

        /* æˆ‘çš„èœå• */
        .my-menu-section {
            background: var(--bg);
            border-radius: 16px;
            padding: 16px;
            margin-top: 16px;
        }
        .my-menu-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .my-menu-title::before {
            content: '';
            width: 4px;
            height: 16px;
            background: linear-gradient(180deg, var(--primary) 0%, var(--primary-dark) 100%);
            border-radius: 2px;
        }
        .my-menu-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 10px;
            margin-bottom: 16px;
        }
        .my-menu-item {
            background: white;
            border-radius: 10px;
            padding: 10px;
            position: relative;
        }
        .my-menu-item-name {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 4px;
        }
        .my-menu-item-meta {
            font-size: 0.75rem;
            color: var(--text-muted);
        }
        .my-menu-item-remove {
            position: absolute;
            top: 6px;
            right: 6px;
            width: 20px;
            height: 20px;
            background: var(--bg);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            color: var(--text-muted);
        }
        .my-menu-item-remove:hover {
            background: var(--accent);
            color: white;
        }
        .my-menu-empty {
            text-align: center;
            color: var(--text-muted);
            font-size: 0.85rem;
            padding: 20px;
        }

        /* è­¦å‘Šæç¤º */
        .warning-msg {
            background: rgba(249, 115, 22, 0.1);
            color: var(--accent);
            padding: 12px 14px;
            border-radius: 12px;
            font-size: 0.85rem;
            margin-bottom: 16px;
            border-left: 3px solid var(--accent);
        }

        /* è¯¦æƒ…å¼¹çª— */
        .modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.4); z-index: 1000; padding: 20px; }
        .modal.show { display: flex; align-items: center; justify-content: center; }
        .modal-content {
            background: white;
            border-radius: 24px;
            max-width: 400px;
            width: 100%;
            max-height: 85vh;
            overflow-y: auto;
            position: relative;
            padding: 24px;
        }
        .modal-close {
            position: absolute;
            top: 16px;
            right: 16px;
            width: 28px;
            height: 28px;
            border: none;
            background: var(--bg);
            border-radius: 50%;
            cursor: pointer;
            color: var(--text-muted);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .modal-close:hover { background: var(--border); }
        .modal-section { margin-bottom: 18px; }
        .modal-title {
            font-size: 0.9rem;
            color: var(--text-muted);
            margin-bottom: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .modal-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 12px;
            background: var(--bg);
            border-radius: 10px;
            margin-bottom: 6px;
            font-size: 0.85rem;
            color: var(--text-dark);
        }
        .modal-row.total {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            margin-top: 12px;
            font-weight: 600;
        }
        .modal-step {
            display: flex;
            gap: 10px;
            padding: 12px;
            background: var(--bg);
            border-radius: 10px;
            margin-bottom: 8px;
            font-size: 0.85rem;
            color: var(--text-dark);
            line-height: 1.5;
        }
        .step-num {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 600;
            flex-shrink: 0;
        }
        .modal h2 { color: var(--text-dark); font-size: 1.25rem; margin-bottom: 6px; font-weight: 600; }
        .modal .info-row { display: flex; gap: 14px; color: var(--text-muted); font-size: 0.85rem; margin-bottom: 16px; }

        /* è´­èœæ¸…å• */
        .shop-list {
            background: var(--bg);
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 12px;
        }
        .shop-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid var(--border);
        }
        .shop-item:last-child { border-bottom: none; }
        .shop-name { font-size: 0.9rem; color: var(--text-dark); font-weight: 500; }
        .shop-amount { font-size: 0.85rem; color: var(--text-muted); margin-left: auto; margin-right: 12px; }
        .shop-price { font-size: 0.9rem; color: var(--accent); font-weight: 600; min-width: 50px; text-align: right; }

        /* è°ƒæ–™æ¸…å• */
        .seasoning-list {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: 12px;
        }
        .seasoning-tag {
            background: var(--bg);
            color: var(--text-dark);
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.75rem;
        }

        /* é¢„ä¼°æ€»é‡‘é¢ */
        .total-amount {
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg);
            color: var(--text-dark);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            margin: 12px auto;
        }
        .total-amount span {
            font-size: 1.1rem;
            color: var(--accent);
            margin-left: 6px;
        }

        /* ç¡®è®¤å¼¹çª— */
        .confirm-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }
        .confirm-modal.show { display: flex; }
        .confirm-content {
            background: var(--cream);
            border-radius: 20px;
            padding: 24px;
            max-width: 320px;
            width: 90%;
            text-align: center;
        }
        .confirm-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 12px;
        }
        .confirm-msg {
            font-size: 0.9rem;
            color: var(--text-muted);
            margin-bottom: 20px;
            line-height: 1.5;
        }
        .confirm-btns {
            display: flex;
            gap: 12px;
        }

        /* é¡µé¢åˆ‡æ¢ */
        .page { display: none; }
        .page.active { display: block; }

        /* èœå•é¡µé¢é¡¶éƒ¨æ  */
        .menu-header {
            width: calc(100% - 0px);
            height: 80px;
            margin: 0 auto 12px;
            border-radius: 16px;
            overflow: hidden;
            position: relative;
            display: flex;
            align-items: center;
            background: white;
            box-shadow: 0 4px 20px var(--shadow);
            padding: 0 16px;
            gap: 8px;
        }
        .back-btn {
            background: var(--bg);
            border: none;
            padding: 8px 10px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 0.8rem;
            color: var(--text-dark);
            box-shadow: 0 1px 4px rgba(0,0,0,0.05);
        }
        .back-btn:hover { background: var(--border); }
        .menu-title {
            flex: 1;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-dark);
            text-align: center;
        }

        /* æ¢ä¸€æ¢æŒ‰é’® */
        .refresh-btn {
            background: #8E8E93;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
            transition: all 0.2s;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }
        .refresh-btn:hover { filter: brightness(1.15); box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2); }
        .refresh-btn:active { transform: scale(0.95); }

        /* åº•éƒ¨æˆ‘çš„èœå•å…¥å£ */
        .my-menu-bar {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            padding: 14px 32px;
            border-radius: 24px;
            box-shadow: 0 4px 20px rgba(250, 181, 113, 0.35);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            color: white;
            font-weight: 600;
            font-size: 1rem;
            z-index: 100;
            transition: all 0.2s;
            max-width: 400px;
            width: calc(100% - 48px);
        }
        .my-menu-bar:hover { transform: translateX(-50%) scale(1.02); }
        .my-menu-bar svg { width: 20px; height: 20px; }

        /* æˆ‘çš„èœå•é¡µé¢ - åº•éƒ¨å¼¹å‡ºåŠå± */
        .my-menu-page {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%) translateY(100%);
            background: white;
            border-radius: 20px 20px 0 0;
            max-height: 75vh;
            width: 100%;
            max-width: 440px;
            z-index: 500;
            transition: transform 0.3s ease;
            display: flex;
            flex-direction: column;
        }
        .my-menu-page.show { transform: translateX(-50%) translateY(0); }
        .my-menu-page-header {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px;
            border-bottom: 1px solid var(--border);
        }
        .close-my-menu-btn {
            background: var(--bg);
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 0.85rem;
            color: var(--text-dark);
            cursor: pointer;
        }
        .close-my-menu-btn:hover { background: var(--border); }
        .my-menu-page-title { flex: 1; font-size: 1.1rem; font-weight: 600; color: var(--text-dark); }
        .my-menu-page-content {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }

        /* æ¢æˆå®ƒæŒ‰é’® */
        .replace-btn {
            background: rgba(16, 185, 129, 0.1);
            color: var(--primary);
            border: 1px solid var(--primary);
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 0.7rem;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
        }
        .replace-btn:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* æ¢èœå¼¹çª— */
        .swap-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 440px;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 600;
            align-items: center;
            justify-content: center;
        }
        .swap-modal.show { display: flex; }
        .swap-content {
            background: white;
            border-radius: 24px;
            width: 90%;
            max-width: 360px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }
        .swap-header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .swap-title { font-size: 1.1rem; font-weight: 600; color: var(--text-dark); }
        .swap-close {
            background: var(--bg);
            border: none;
            font-size: 1.2rem;
            color: var(--text-muted);
            cursor: pointer;
            padding: 6px 10px;
            border-radius: 50%;
        }
        .swap-close:hover { background: var(--border); color: var(--text-dark); }
        .swap-body { padding: 20px; }
        .swap-tip {
            font-size: 0.9rem;
            color: var(--text-muted);
            margin-bottom: 16px;
            text-align: center;
            background: var(--bg);
            padding: 10px;
            border-radius: 12px;
        }
        .swap-item {
            background: white;
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 14px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .swap-item:hover { background: var(--bg); border-color: var(--primary); }
        .swap-item.selected {
            background: rgba(255, 149, 0, 0.1);
            border-color: var(--accent);
            box-shadow: 0 2px 8px rgba(255, 149, 0, 0.2);
        }
        .swap-item-name { font-size: 0.95rem; font-weight: 600; color: var(--text-dark); }
        .swap-item-meta { font-size: 0.8rem; color: var(--text-muted); margin-top: 4px; }
        .swap-btns {
            display: flex;
            gap: 12px;
            padding: 16px 20px 20px;
        }
        .swap-btn {
            flex: 1;
            padding: 14px;
            border-radius: 22px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        .swap-btn.cancel {
            background: var(--bg);
            border: none;
            color: var(--text-dark);
        }
        .swap-btn.cancel:hover { background: var(--border); }
        .swap-btn.confirm {
            background: linear-gradient(135deg, #be831f 0%, #a7731b 100%);
            border: none;
            color: white;
            box-shadow: 0 4px 12px rgba(190, 131, 31, 0.3);
        }
        .swap-btn.confirm:hover { opacity: 0.9; transform: translateY(-1px); }
        .swap-btn:disabled { opacity: 0.5; cursor: not-allowed; }

        /* ç»Ÿä¸€æŒ‰é’®æ ·å¼ */
        .menu-action-btn {
            width: 20px;
            height: 20px;
            padding: 0;
            border-radius: 50%;
            font-size: 0.75rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
        }
        /* å·²åŠ å…¥çŠ¶æ€ - æ©™è‰²å¯¹å‹¾ */
        .menu-action-btn.added {
            background: var(--accent);
            color: white;
            font-size: 0.6rem;
        }
        /* åŠ å·çŠ¶æ€ */
        .menu-action-btn:not(.added):not(.replace) {
            background: white;
            color: var(--accent);
            border: 1px solid var(--accent);
            font-size: 0.85rem;
        }
        .menu-action-btn:not(.added):not(.replace):hover {
            background: var(--accent);
            color: white;
        }
        /* æ¢æˆå®ƒçŠ¶æ€ */
        .menu-action-btn.replace {
            background: rgba(255, 149, 0, 0.15);
            color: var(--accent);
            border: 1px solid var(--accent);
            border-radius: 6px;
            width: auto;
            padding: 2px 8px;
            font-size: 0.65rem;
        }
        .menu-action-btn.replace:hover {
            background: var(--accent);
            color: white;
        }

        .my-menu-overlay {
            position: fixed;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 440px;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 499;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }
        .my-menu-overlay.show { opacity: 1; visibility: visible; }

        /* ç»Ÿä¸€é¡µé¢å®½åº¦ */
        .page-wrapper {
            max-width: 440px;
            margin: 0 auto;
            position: relative;
        }

        /* å¤‡èœæ¸…å•åœ¨è¯¦æƒ…é¡µçš„æ ·å¼ */
        .detail-shop-list {
            background: var(--bg);
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 12px;
        }
        .detail-shop-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid var(--border);
        }
        .detail-shop-item:last-child { border-bottom: none; }
        .detail-shop-name { font-size: 0.9rem; color: var(--text-dark); font-weight: 500; }
        .detail-shop-amount { font-size: 0.85rem; color: var(--text-muted); margin-left: auto; margin-right: 12px; }
        .detail-shop-price { font-size: 0.9rem; color: var(--accent); font-weight: 600; min-width: 50px; text-align: right; }

        /* è¯¦æƒ…é¡µè°ƒæ–™æ ‡ç­¾ */
        .detail-seasoning-tag {
            background: var(--bg);
            color: var(--text-dark);
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.75rem;
        }

        /* é˜²æ­¢åº•éƒ¨è¢«é®æŒ¡ */
        .container { padding: 16px; padding-bottom: 90px; }

        /* æˆ‘çš„èœå•æŒ‰ç±»å‹åˆ†ç»„æ˜¾ç¤º */
        .my-menu-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 16px;
        }
        .my-menu-grid-item {
            background: white;
            border-radius: 10px;
            padding: 10px;
            position: relative;
            text-align: center;
        }
        .my-menu-item-name {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 4px;
        }
        .my-menu-item-meta {
            font-size: 0.75rem;
            color: var(--text-muted);
        }
        .my-menu-item-remove {
            position: absolute;
            top: -6px;
            right: -6px;
            width: 22px;
            height: 22px;
            background: #FF3B30;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            font-weight: 600;
            color: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        .my-menu-item-remove:hover {
            transform: scale(1.1);
        }

        /* é¢„ä¼°æ€»é‡‘é¢æ–‡æœ¬æ ·å¼ */
        .my-menu-total {
            background: var(--bg);
            color: var(--text-dark);
            padding: 12px 16px;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .my-menu-total span {
            color: var(--accent);
            font-size: 1.1rem;
        }

        /* åº•éƒ¨æŒ‰é’®åŒºåŸŸ */
        .my-menu-footer {
            padding: 16px;
            border-top: 1px solid var(--border);
            margin-top: auto;
        }
        .generate-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            border: none;
            border-radius: 22px;
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 16px rgba(250, 181, 113, 0.3);
        }
        .generate-btn:hover { opacity: 0.9; transform: translateY(-1px); }

        /* ç¬¬å››é¡µï¼šå¤‡èœæ¸…å•é¡µé¢ */
        .prep-page {
            display: none;
            position: fixed;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 440px;
            height: 100%;
            background: white;
            z-index: 600;
            flex-direction: column;
        }
        .prep-page.show { display: flex; }
        .prep-header {
            display: flex;
            align-items: center;
            padding: 16px;
            border-bottom: 1px solid var(--border);
        }
        .prep-title {
            flex: 1;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-dark);
            text-align: center;
        }
        .prep-content {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }
        .prep-shop-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid var(--border);
        }
        .prep-shop-name { font-size: 0.9rem; color: var(--text-dark); }
        .prep-shop-right { display: flex; align-items: center; gap: 12px; }
        .prep-shop-amount { font-size: 0.85rem; color: var(--text-muted); }
        .prep-shop-price { font-size: 0.9rem; color: var(--accent); font-weight: 600; }
        .prep-seasoning-tag {
            display: inline-block;
            background: var(--bg);
            color: var(--text-dark);
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8rem;
            margin: 4px;
        }
        .prep-total {
            padding: 16px;
            background: var(--bg);
            border-top: 1px solid var(--border);
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-dark);
            display: flex;
            justify-content: space-between;
        }
        .prep-total span {
            color: var(--accent);
            font-size: 1.2rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ç¬¬ä¸€é¡µï¼šå‚æ•°è¾“å…¥ -->
        <div class="page active" id="inputPage">
            <div class="hero-banner">
                <div class="hero-content">
                    <h1>AIèœå•åŠ©æ‰‹ğŸ›’</h1>
                    <p>æ™ºèƒ½æ¨èä»Šæ—¥èœå•</p>
                </div>
            </div>

            <div class="card">
                <!-- è£…é¥°å›¾ç‰‡ -->
                <div class="decor-img">
                    <img src="https://images.unsplash.com/photo-1504674900247-0877df9cc836?w=400&h=120&fit=crop" alt="ç¾é£Ÿ">
                </div>
                <div class="form-item">
                    <label class="label">ç”¨é¤äººæ•°</label>
                    <div class="count-grid">
                        <div class="count-item">
                            <div class="count-controls">
                                <button class="count-btn" onclick="changePeople(-1)">-</button>
                                <span class="count-value" id="peopleVal">1</span>
                                <button class="count-btn" onclick="changePeople(1)">+</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-item">
                    <label class="label">ç¾é£Ÿç±»å‹</label>
                    <div class="type-tags" id="typeTags">
                        <span class="type-tag" onmousedown="selectType('ä¸­å¼ç‚’èœ', event)">ğŸ¥¢ ä¸­é¤</span>
                        <span class="type-tag" onmousedown="selectType('ç«é”…', event)">ğŸ¥˜ ç«é”…</span>
                        <span class="type-tag" onmousedown="selectType('çƒ§çƒ¤', event)">ğŸ¢ çƒ§çƒ¤</span>
                        <span class="type-tag" onmousedown="selectType('è¥¿é¤', event)">ğŸ¥— è¥¿é¤</span>
                        <span class="type-tag" onmousedown="selectType('ä¸œå—äºšèœ', event)">ğŸŒ´ ä¸œå—äºš</span>
                    </div>
                    <div class="error-msg" id="typeError">è¯·é€‰æ‹©ç¾é£Ÿç±»å‹</div>
                </div>

                <!-- æ•°é‡é€‰é¡¹ï¼šç»Ÿä¸€åŒºåŸŸ -->
            <div class="qty-section show" id="qtySection">
                <div class="qty-title">æ•°é‡<span style="color:var(--text-muted);font-weight:400;font-size:0.8rem;margin-left:4px;">ï¼ˆè‡ªåŠ¨æ¨èï¼Œä¹Ÿå¯ä»¥ä¿®æ”¹ï¼‰</span></div>
                <div id="qtyPlaceholder" class="qty-placeholder">è¯·å…ˆé€‰æ‹©ç¾é£Ÿç±»å‹</div>
                <!-- ä¸­å¼ç‚’èœ/ä¸œå—äºšèœ -->
                <div class="count-grid" id="qtyStir" style="display:none;">
                    <div class="count-item">
                        <div class="count-label">å‡‰èœ</div>
                        <div class="count-controls">
                            <button class="count-btn" onclick="changeQty('cold', -1)">-</button>
                            <span class="count-value" id="coldVal">0</span>
                            <button class="count-btn" onclick="changeQty('cold', 1)">+</button>
                        </div>
                    </div>
                    <div class="count-item">
                        <div class="count-label">çƒ­èœ</div>
                        <div class="count-controls">
                            <button class="count-btn" onclick="changeQty('hot', -1)">-</button>
                            <span class="count-value" id="hotVal">2</span>
                            <button class="count-btn" onclick="changeQty('hot', 1)">+</button>
                        </div>
                    </div>
                    <div class="count-item">
                        <div class="count-label">æ±¤ç±»</div>
                        <div class="count-controls">
                            <button class="count-btn" onclick="changeQty('soup', -1)">-</button>
                            <span class="count-value" id="soupVal">0</span>
                            <button class="count-btn" onclick="changeQty('soup', 1)">+</button>
                        </div>
                    </div>
                    <div class="count-item">
                        <div class="count-label">ä¸»é£Ÿ</div>
                        <div class="count-controls">
                            <button class="count-btn" onclick="changeQty('staple', -1)">-</button>
                            <span class="count-value" id="stapleVal">1</span>
                            <button class="count-btn" onclick="changeQty('staple', 1)">+</button>
                        </div>
                    </div>
                </div>
                <!-- ç«é”…/çƒ§çƒ¤ -->
                <div class="count-grid" id="qtyHotpot" style="display:none;">
                    <div class="count-item">
                        <div class="count-label">è¤ç±»</div>
                        <div class="count-controls">
                            <button class="count-btn" onclick="changeQty('meat', -1)">-</button>
                            <span class="count-value" id="meatVal">1</span>
                            <button class="count-btn" onclick="changeQty('meat', 1)">+</button>
                        </div>
                    </div>
                    <div class="count-item">
                        <div class="count-label">ç´ ç±»</div>
                        <div class="count-controls">
                            <button class="count-btn" onclick="changeQty('veg', -1)">-</button>
                            <span class="count-value" id="vegVal">1</span>
                            <button class="count-btn" onclick="changeQty('veg', 1)">+</button>
                        </div>
                    </div>
                    <div class="count-item">
                        <div class="count-label">ä¸»é£Ÿ</div>
                        <div class="count-controls">
                            <button class="count-btn" onclick="changeQty('stapleH', -1)">-</button>
                            <span class="count-value" id="stapleHVal">1</span>
                            <button class="count-btn" onclick="changeQty('stapleH', 1)">+</button>
                        </div>
                    </div>
                </div>
                <!-- è¥¿é¤ -->
                <div class="count-grid" id="qtyWestern" style="display:none;">
                    <div class="count-item">
                        <div class="count-label">å‰èœ</div>
                        <div class="count-controls">
                            <button class="count-btn" onclick="changeQty('appetizer', -1)">-</button>
                            <span class="count-value" id="appetizerVal">0</span>
                            <button class="count-btn" onclick="changeQty('appetizer', 1)">+</button>
                        </div>
                    </div>
                    <div class="count-item">
                        <div class="count-label">ä¸»èœ</div>
                        <div class="count-controls">
                            <button class="count-btn" onclick="changeQty('main', -1)">-</button>
                            <span class="count-value" id="mainVal">1</span>
                            <button class="count-btn" onclick="changeQty('main', 1)">+</button>
                        </div>
                    </div>
                    <div class="count-item">
                        <div class="count-label">å°é£Ÿ</div>
                        <div class="count-controls">
                            <button class="count-btn" onclick="changeQty('side', -1)">-</button>
                            <span class="count-value" id="sideVal">0</span>
                            <button class="count-btn" onclick="changeQty('side', 1)">+</button>
                        </div>
                    </div>
                    <div class="count-item">
                        <div class="count-label">ç”œç‚¹</div>
                        <div class="count-controls">
                            <button class="count-btn" onclick="changeQty('dessert', -1)">-</button>
                            <span class="count-value" id="dessertVal">1</span>
                            <button class="count-btn" onclick="changeQty('dessert', 1)">+</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-item">
                <label class="label">ç°æœ‰é£ŸæğŸ§º<span class="hint">ï¼ˆå¯é€‰ï¼‰</span></label>
                <input type="text" class="input-field" id="ingredients" placeholder="å¤šç§é£Ÿæç”¨é€—å·åˆ†éš”ï¼Œå¦‚ï¼šè¥¿çº¢æŸ¿ï¼Œé¸¡è›‹">
            </div>

            <div class="form-item" style="margin-top: 16px;">
                <button class="submit-btn" onclick="goToMenuPage()">ç”Ÿæˆæ¨èèœå•</button>
            </div>
        </div>
        </div> <!-- ç¬¬ä¸€é¡µç»“æŸ -->

        <!-- ç¬¬äºŒé¡µï¼šæ¨èèœå• -->
        <div class="page" id="menuPage">
            <div class="menu-header">
                <button class="back-btn" onclick="goToInputPage()">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
                </button>
                <div class="menu-title">æ¨èèœå•</div>
                <button class="refresh-btn" style="background: #cbacde;" onclick="addAllToMenu()">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12h14"/></svg>
                    å…¨éƒ¨åŠ å…¥
                </button>
                <button class="refresh-btn" onclick="refreshMenu()">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 4v6h-6M1 20v-6h6"/><path d="M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"/></svg>
                    æ¢ä¸€æ¢
                </button>
            </div>
            <div class="card result-card" id="resultCard">
                <div id="resultContent"></div>
            </div>
        </div>

        <!-- æˆ‘çš„èœå•å¼¹å±‚ -->
        <div class="my-menu-overlay" id="myMenuOverlay" onclick="closeMyMenuPage()"></div>
        <div class="my-menu-page" id="myMenuPage">
            <div class="my-menu-page-header">
                <button class="close-my-menu-btn" onclick="closeMyMenuPage()">å…³é—­</button>
                <div class="my-menu-page-title">æˆ‘çš„èœå•</div>
            </div>
            <div class="my-menu-page-content" id="myMenuContent"></div>
            <div class="my-menu-footer">
                <button class="generate-btn" onclick="goToPrepPage()">ç”Ÿæˆå¤‡èœæ¸…å•</button>
            </div>
        </div>

        <!-- ç¬¬å››é¡µï¼šå¤‡èœæ¸…å•é¡µé¢ -->
        <div class="prep-page" id="prepPage">
            <div class="prep-header">
                <button class="close-my-menu-btn" onclick="closePrepPage()">è¿”å›</button>
                <div class="prep-title">å¤‡èœæ¸…å•</div>
            </div>
            <div class="prep-content" id="prepContent"></div>
            <div class="prep-total" id="prepTotal"></div>
        </div>

        <!-- åº•éƒ¨æ‚¬æµ®çš„æˆ‘çš„èœå•å…¥å£ -->
        <div class="my-menu-bar" id="myMenuBar" onclick="openMyMenuPage()" style="display:none;">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/></svg>
            <span>æˆ‘çš„èœå•</span>
            <span id="myMenuCount">(0)</span>
        </div>

    <div class="modal" id="detailModal">
        <div class="modal-content" id="modalContent"></div>
    </div>

    <script>
        // æ™ºèƒ½æ¨èé…ç½®
        const stirRec = {
            '1': {cold:0, hot:2, soup:0, staple:1},
            '2-3': {cold:1, hot:3, soup:1, staple:1},
            '4-6': {cold:1, hot:5, soup:1, staple:1},
            '6-8': {cold:2, hot:6, soup:1, staple:1},
            '8-10': {cold:2, hot:8, soup:1, staple:1}
        };
        const hotpotRec = {
            '1': {meat:1, veg:1, staple:0},
            '2': {meat:2, veg:2, staple:1},
            '3': {meat:3, veg:3, staple:1},
            '4': {meat:4, veg:3, staple:1},
            '5': {meat:5, veg:4, staple:1},
            '6': {meat:6, veg:4, staple:2},
            '7': {meat:7, veg:5, staple:2},
            '8': {meat:8, veg:6, staple:2},
            '9': {meat:9, veg:6, staple:3},
            '10': {meat:10, veg:7, staple:3}
        };
        const westernRec = {
            '1': {appetizer:0, main:1, side:0, dessert:1},
            '2': {appetizer:1, main:2, side:0, dessert:1},
            '3': {appetizer:1, main:3, side:1, dessert:1},
            '4': {appetizer:2, main:4, side:1, dessert:2},
            '5': {appetizer:2, main:5, side:1, dessert:2},
            '6': {appetizer:2, main:6, side:2, dessert:2},
            '7': {appetizer:3, main:7, side:2, dessert:3},
            '8': {appetizer:3, main:8, side:2, dessert:3},
            '9': {appetizer:3, main:9, side:3, dessert:3},
            '10': {appetizer:4, main:10, side:3, dessert:4}
        };

        let peopleCount = 1;
        let selectedType = null;
        let stirCounts = {cold:0, hot:2, soup:0, staple:1};
        let hotpotCounts = {meat:1, veg:1, stapleH:1};
        let westernCounts = {appetizer:0, main:1, side:0, dessert:1};
        window.myMenu = [];

        // æ¢èœç›¸å…³å˜é‡
        let pendingSwapRecipe = null;
        let pendingSwapTypeKey = null;
        let selectedSwapIndex = -1;

        function changePeople(delta) {
            peopleCount = Math.max(1, Math.min(10, peopleCount + delta));
            document.getElementById('peopleVal').textContent = peopleCount;
            updateRec();
        }

        function selectType(type, e) {
            if (!e) return;
            selectedType = type;
            document.querySelectorAll('.type-tag').forEach(t => t.classList.remove('selected'));
            e.target.classList.add('selected');
            document.getElementById('typeError').classList.remove('show');

            // éšè—æ‰€æœ‰æ•°é‡é€‰é¡¹å’Œæç¤º
            document.getElementById('qtyPlaceholder').style.display = 'none';
            document.getElementById('qtyStir').style.display = 'none';
            document.getElementById('qtyHotpot').style.display = 'none';
            document.getElementById('qtyWestern').style.display = 'none';

            if (type === 'ä¸­å¼ç‚’èœ' || type === 'ä¸œå—äºšèœ') {
                document.getElementById('qtyStir').style.display = 'grid';
                updateRec();
            } else if (type === 'ç«é”…' || type === 'çƒ§çƒ¤') {
                document.getElementById('qtyHotpot').style.display = 'grid';
                updateRec();
            } else if (type === 'è¥¿é¤') {
                document.getElementById('qtyWestern').style.display = 'grid';
                updateRec();
            }
        }

        function updateRec() {
            if (!selectedType) return;

            if (selectedType === 'ä¸­å¼ç‚’èœ' || selectedType === 'ä¸œå—äºšèœ') {
                const r = peopleCount===1?'1':peopleCount<=3?'2-3':peopleCount<=6?'4-6':peopleCount<=8?'6-8':'8-10';
                stirCounts = {
                    cold: stirRec[r].cold,
                    hot: stirRec[r].hot,
                    soup: stirRec[r].soup,
                    staple: stirRec[r].staple
                };
                ['cold','hot','soup','staple'].forEach(k => {
                    document.getElementById(k+'Val').textContent = stirCounts[k];
                });
            } else if (selectedType === 'ç«é”…' || selectedType === 'çƒ§çƒ¤') {
                const r = peopleCount.toString();
                hotpotCounts = {
                    meat: hotpotRec[r].meat,
                    veg: hotpotRec[r].veg,
                    stapleH: hotpotRec[r].staple
                };
                ['meat','veg','stapleH'].forEach(k => {
                    document.getElementById(k+'Val').textContent = hotpotCounts[k];
                });
            } else if (selectedType === 'è¥¿é¤') {
                const r = peopleCount.toString();
                westernCounts = {
                    appetizer: westernRec[r].appetizer,
                    main: westernRec[r].main,
                    side: westernRec[r].side,
                    dessert: westernRec[r].dessert
                };
                ['appetizer','main','side','dessert'].forEach(k => {
                    document.getElementById(k+'Val').textContent = westernCounts[k];
                });
            }
        }

        function changeQty(type, delta) {
            if (selectedType === 'ä¸­å¼ç‚’èœ' || selectedType === 'ä¸œå—äºšèœ') {
                stirCounts[type] = Math.max(0, Math.min(10, stirCounts[type] + delta));
                document.getElementById(type+'Val').textContent = stirCounts[type];
            } else if (selectedType === 'ç«é”…' || selectedType === 'çƒ§çƒ¤') {
                hotpotCounts[type] = Math.max(0, Math.min(10, hotpotCounts[type] + delta));
                document.getElementById(type+'Val').textContent = hotpotCounts[type];
            } else if (selectedType === 'è¥¿é¤') {
                westernCounts[type] = Math.max(0, Math.min(10, westernCounts[type] + delta));
                document.getElementById(type+'Val').textContent = westernCounts[type];
            }
        }

        const recipes = {
            'ä¸­å¼ç‚’èœ': {
                cold:[{n:'å‡‰æ‹Œé»„ç“œ',d:'ç®€å•',t:'10åˆ†é’Ÿ',i:[{n:'é»„ç“œ',a:'2æ ¹',p:4},{n:'è’œæ³¥',a:'é€‚é‡',p:0.5},{n:'é¦™æ²¹',a:'1å‹º',p:0.5}],s:['é»„ç“œæ‹ç¢','åŠ è’œæ³¥é¦™æ²¹','æ‹ŒåŒ€']},{n:'çš®è›‹è±†è…',d:'ç®€å•',t:'5åˆ†é’Ÿ',i:[{n:'å«©è±†è…',a:'1å—',p:3},{n:'çš®è›‹',a:'2ä¸ª',p:6}],s:['è±†è…åˆ‡å—','çš®è›‹åˆ‡ä¸','æ·‹ç”ŸæŠ½é¦™æ²¹']}],
                hot:[{n:'è¥¿çº¢æŸ¿ç‚’è›‹',d:'ç®€å•',t:'10åˆ†é’Ÿ',i:[{n:'è¥¿çº¢æŸ¿',a:'3ä¸ª',p:5},{n:'é¸¡è›‹',a:'3ä¸ª',p:5},{n:'ç³–',a:'1å°å‹º',p:0.3}],s:['è¥¿çº¢æŸ¿åˆ‡å—','é¸¡è›‹ç‚’ç†Ÿ','æ··åˆç¿»ç‚’']},{n:'é’æ¤’åœŸè±†ä¸',d:'ç®€å•',t:'15åˆ†é’Ÿ',i:[{n:'åœŸè±†',a:'2ä¸ª',p:4},{n:'é’æ¤’',a:'2ä¸ª',p:3}],s:['åœŸè±†é’æ¤’åˆ‡ä¸','å¿«ç«ç¿»ç‚’','åŠ é†‹ç›']},{n:'éº»å©†è±†è…',d:'ä¸­ç­‰',t:'20åˆ†é’Ÿ',i:[{n:'å«©è±†è…',a:'400g',p:6},{n:'ç‰›è‚‰æœ«',a:'100g',p:12},{n:'è±†ç“£é…±',a:'2å‹º',p:0.8}],s:['è±†è…ç„¯æ°´','ç‚’è‚‰æœ«è±†ç“£','ä¸‹è±†è…ç…®']},{n:'å®«ä¿é¸¡ä¸',d:'ä¸­ç­‰',t:'25åˆ†é’Ÿ',i:[{n:'é¸¡èƒ¸è‚‰',a:'300g',p:18},{n:'èŠ±ç”Ÿç±³',a:'50g',p:3},{n:'å¹²è¾£æ¤’',a:'é€‚é‡',p:0.8}],s:['é¸¡ä¸è…Œåˆ¶','ç‚¸èŠ±ç”Ÿç±³','å¿«ç«ç¿»ç‚’']},{n:'çº¢çƒ§è‚‰',d:'ä¸­ç­‰',t:'40åˆ†é’Ÿ',i:[{n:'äº”èŠ±è‚‰',a:'400g',p:35},{n:'å†°ç³–',a:'é€‚é‡',p:2},{n:'é…±æ²¹',a:'é€‚é‡',p:1}],s:['äº”èŠ±è‚‰åˆ‡å—','ç‚’ç³–è‰²','åŠ é…±æ²¹ç‚–ç…®']},{n:'ç³–é†‹æ’éª¨',d:'ä¸­ç­‰',t:'35åˆ†é’Ÿ',i:[{n:'æ’éª¨',a:'500g',p:40},{n:'é†‹',a:'2å‹º',p:2},{n:'ç³–',a:'3å‹º',p:2}],s:['æ’éª¨ç„¯æ°´','è°ƒç³–é†‹æ±','æ’éª¨ç¿»ç‚’ä¸Šè‰²']},{n:'è’œè“‰è™¾',d:'ä¸­ç­‰',t:'20åˆ†é’Ÿ',i:[{n:'å¤§è™¾',a:'300g',p:28},{n:'è’œ',a:'1å¤´',p:3}],s:['è™¾æ´—å‡€','è’œè“‰çˆ†é¦™','è™¾ç¿»ç‚’']}],
                hotMeat:[{n:'å®«ä¿é¸¡ä¸',d:'ä¸­ç­‰',t:'25åˆ†é’Ÿ',i:[{n:'é¸¡èƒ¸è‚‰',a:'300g',p:18},{n:'èŠ±ç”Ÿç±³',a:'50g',p:3},{n:'å¹²è¾£æ¤’',a:'é€‚é‡',p:0.8}],s:['é¸¡ä¸è…Œåˆ¶','ç‚¸èŠ±ç”Ÿç±³','å¿«ç«ç¿»ç‚’']},{n:'çº¢çƒ§è‚‰',d:'ä¸­ç­‰',t:'40åˆ†é’Ÿ',i:[{n:'äº”èŠ±è‚‰',a:'400g',p:35},{n:'å†°ç³–',a:'é€‚é‡',p:2},{n:'é…±æ²¹',a:'é€‚é‡',p:1}],s:['äº”èŠ±è‚‰åˆ‡å—','ç‚’ç³–è‰²','åŠ é…±æ²¹ç‚–ç…®']},{n:'ç³–é†‹æ’éª¨',d:'ä¸­ç­‰',t:'35åˆ†é’Ÿ',i:[{n:'æ’éª¨',a:'500g',p:40},{n:'é†‹',a:'2å‹º',p:2},{n:'ç³–',a:'3å‹º',p:2}],s:['æ’éª¨ç„¯æ°´','è°ƒç³–é†‹æ±','æ’éª¨ç¿»ç‚’ä¸Šè‰²']},{n:'è’œè“‰è™¾',d:'ä¸­ç­‰',t:'20åˆ†é’Ÿ',i:[{n:'å¤§è™¾',a:'300g',p:28},{n:'è’œ',a:'1å¤´',p:3}],s:['è™¾æ´—å‡€','è’œè“‰çˆ†é¦™','è™¾ç¿»ç‚’']}],
                soup:[{n:'ç´«èœè›‹èŠ±æ±¤',d:'ç®€å•',t:'10åˆ†é’Ÿ',i:[{n:'ç´«èœ',a:'é€‚é‡',p:2},{n:'é¸¡è›‹',a:'1ä¸ª',p:1.5}],s:['ç´«èœæ´—å‡€','æ°´å¼€ä¸‹é”…','æ·‹è›‹æ¶²']},{n:'ç•ªèŒ„è›‹æ±¤',d:'ç®€å•',t:'10åˆ†é’Ÿ',i:[{n:'ç•ªèŒ„',a:'2ä¸ª',p:4},{n:'é¸¡è›‹',a:'2ä¸ª',p:3}],s:['ç•ªèŒ„åˆ‡å—','åŠ æ°´ç…®','æ·‹è›‹æ¶²']}],
                staple:[{n:'è›‹ç‚’é¥­',d:'ç®€å•',t:'10åˆ†é’Ÿ',i:[{n:'ç±³é¥­',a:'1ç¢—',p:2},{n:'é¸¡è›‹',a:'2ä¸ª',p:3}],s:['ç±³é¥­æ£æ•£','çƒ­é”…ç‚’è›‹','æ··åˆç¿»ç‚’']},{n:'ç‚’é¢æ¡',d:'ç®€å•',t:'15åˆ†é’Ÿ',i:[{n:'é¢æ¡',a:'200g',p:4},{n:'é¸¡è›‹',a:'2ä¸ª',p:3}],s:['é¢æ¡ç…®ç†Ÿ','é…èœç¿»ç‚’','æ··åˆç‚’åŒ€']}]
            },
            'ç«é”…': {
                meat:[{n:'è‚¥ç‰›å·',d:'ç®€å•',t:'5åˆ†é’Ÿ',i:[{n:'è‚¥ç‰›å·',a:'300g',p:35}],s:['ä¸‹é”…æ¶®10ç§’','è˜¸æ–™é£Ÿç”¨']},{n:'ç¾Šè‚‰å·',d:'ç®€å•',t:'5åˆ†é’Ÿ',i:[{n:'ç¾Šè‚‰å·',a:'300g',p:30}],s:['ä¸‹é”…æ¶®10ç§’','è˜¸æ–™é£Ÿç”¨']},{n:'è™¾æ»‘',d:'ç®€å•',t:'5åˆ†é’Ÿ',i:[{n:'è™¾æ»‘',a:'200g',p:25}],s:['ä¸‹é”…ç…®æµ®èµ·','è˜¸æ–™é£Ÿç”¨']},{n:'æ¯›è‚š',d:'ç®€å•',t:'30ç§’',i:[{n:'æ¯›è‚š',a:'200g',p:28}],s:['ä¸‹é”…æ¶®15ç§’','è˜¸æ–™é£Ÿç”¨']}],
                veg:[{n:'èŒ¼è’¿',d:'ç®€å•',t:'2åˆ†é’Ÿ',i:[{n:'èŒ¼è’¿',a:'1æŠŠ',p:6}],s:['ä¸‹é”…æ¶®ç†Ÿ','è˜¸æ–™é£Ÿç”¨']},{n:'ç”Ÿèœ',d:'ç®€å•',t:'2åˆ†é’Ÿ',i:[{n:'ç”Ÿèœ',a:'1é¢—',p:5}],s:['ä¸‹é”…æ¶®ç†Ÿ','è˜¸æ–™é£Ÿç”¨']},{n:'è±†è…',d:'ç®€å•',t:'5åˆ†é’Ÿ',i:[{n:'è±†è…',a:'1å—',p:3}],s:['ä¸‹é”…ç…®','è˜¸æ–™é£Ÿç”¨']},{n:'åœŸè±†ç‰‡',d:'ç®€å•',t:'3åˆ†é’Ÿ',i:[{n:'åœŸè±†',a:'2ä¸ª',p:4}],s:['ä¸‹é”…ç…®è½¯','è˜¸æ–™é£Ÿç”¨']},{n:'è—•ç‰‡',d:'ç®€å•',t:'3åˆ†é’Ÿ',i:[{n:'è²è—•',a:'1èŠ‚',p:5}],s:['åˆ‡ç‰‡ä¸‹é”…','ç…®ç†Ÿé£Ÿç”¨']}],
                staple:[{n:'ç²‰ä¸',d:'ç®€å•',t:'5åˆ†é’Ÿ',i:[{n:'ç²‰ä¸',a:'1æŠŠ',p:3}],s:['ä¸‹é”…ç…®è½¯','è˜¸æ–™é£Ÿç”¨']},{n:'æ–¹ä¾¿é¢',d:'ç®€å•',t:'5åˆ†é’Ÿ',i:[{n:'æ–¹ä¾¿é¢',a:'1è¢‹',p:4}],s:['ä¸‹é”…ç…®','åŠ è›‹æ›´ä½³']},{n:'å¹´ç³•',d:'ç®€å•',t:'5åˆ†é’Ÿ',i:[{n:'å¹´ç³•',a:'200g',p:6}],s:['ä¸‹é”…ç…®è½¯','è˜¸ç³–æˆ–ç›']}]
            },
            'çƒ§çƒ¤': {
                meat:[{n:'ç¾Šè‚‰ä¸²',d:'ä¸­ç­‰',t:'20åˆ†é’Ÿ',i:[{n:'ç¾Šè‚‰ä¸²',a:'10ä¸²',p:25}],s:['æå‰è…Œåˆ¶','åˆ·æ²¹çƒ¤åˆ¶','æ’’å­œç„¶è¾£æ¤’']},{n:'é¸¡ç¿…',d:'ä¸­ç­‰',t:'25åˆ†é’Ÿ',i:[{n:'é¸¡ç¿…',a:'5ä¸ª',p:15}],s:['åˆ’åˆ€è…Œåˆ¶','åˆ·èœœçƒ¤åˆ¶','ä¸¤é¢é‡‘é»„']},{n:'äº”èŠ±è‚‰',d:'ä¸­ç­‰',t:'15åˆ†é’Ÿ',i:[{n:'äº”èŠ±è‚‰',a:'200g',p:18}],s:['åˆ‡ç‰‡è…Œåˆ¶','çƒ¤è‡³å‡ºæ²¹','å·ç”Ÿèœé£Ÿç”¨']},{n:'ç‰›è‚‰ä¸²',d:'ä¸­ç­‰',t:'20åˆ†é’Ÿ',i:[{n:'ç‰›è‚‰ä¸²',a:'10ä¸²',p:28}],s:['æå‰è…Œåˆ¶','å¿«ç«çƒ¤åˆ¶','æ’’èŠéº»']}],
                veg:[{n:'èŒ¼è’¿',d:'ç®€å•',t:'8åˆ†é’Ÿ',i:[{n:'èŒ¼è’¿',a:'1æŠŠ',p:6}],s:['æ´—å‡€ä¸²å¥½','åˆ·æ²¹å¿«çƒ¤','æ’’å­œç„¶']},{n:'ç‰ç±³',d:'ç®€å•',t:'15åˆ†é’Ÿ',i:[{n:'ç‰ç±³',a:'2æ ¹',p:6}],s:['åˆ·æ²¹çƒ¤åˆ¶','æ’’ç³–æˆ–ç›','ä¸¤é¢é‡‘é»„']},{n:'åœŸè±†ç‰‡',d:'ç®€å•',t:'10åˆ†é’Ÿ',i:[{n:'åœŸè±†',a:'2ä¸ª',p:4}],s:['åˆ‡ç‰‡åˆ·æ²¹','çƒ¤è‡³å¾®ç„¦','æ’’æ¤’ç›']},{n:'èŒ„å­',d:'ç®€å•',t:'15åˆ†é’Ÿ',i:[{n:'èŒ„å­',a:'2æ ¹',p:5}],s:['å¯¹åŠåˆ‡å¼€','åˆ·æ²¹çƒ¤åˆ¶','æ’’è’œè“‰']},{n:'éŸ­èœ',d:'ç®€å•',t:'8åˆ†é’Ÿ',i:[{n:'éŸ­èœ',a:'1æŠŠ',p:4}],s:['æ´—å‡€ä¸²å¥½','åˆ·æ²¹å¿«çƒ¤','æ’’å­œç„¶']},{n:'é‡‘é’ˆè‡',d:'ç®€å•',t:'8åˆ†é’Ÿ',i:[{n:'é‡‘é’ˆè‡',a:'1æŠŠ',p:5}],s:['æ´—å‡€æ²¥å¹²','åˆ·æ²¹çƒ¤åˆ¶','æ’’æ¤’ç›']}],
                staple:[{n:'é¦’å¤´ç‰‡',d:'ç®€å•',t:'8åˆ†é’Ÿ',i:[{n:'é¦’å¤´',a:'2ä¸ª',p:4}],s:['åˆ‡ç‰‡åˆ·æ²¹','çƒ¤è‡³é‡‘é»„','æ’’å­œç„¶']},{n:'å¹´ç³•',d:'ç®€å•',t:'10åˆ†é’Ÿ',i:[{n:'å¹´ç³•',a:'200g',p:6}],s:['åˆ‡ç‰‡åˆ·æ²¹','çƒ¤è‡³é¼“åŒ…','è˜¸ç³–']}]
            },
            'è¥¿é¤': {
                appetizer:[{n:'å‡¯æ’’æ²™æ‹‰',d:'ç®€å•',t:'10åˆ†é’Ÿ',i:[{n:'ç”Ÿèœ',a:'1é¢—',p:6},{n:'é¢åŒ…ä¸',a:'50g',p:3},{n:'å¸•ç›æ£®å¥¶é…ª',a:'30g',p:8}],s:['ç”Ÿèœæ´—å‡€æ²¥å¹²','æ··åˆæ²™æ‹‰é…±','æ’’ä¸Šé¢åŒ…ä¸å’Œå¥¶é…ª']},{n:'è’œé¦™é¢åŒ…',d:'ç®€å•',t:'10åˆ†é’Ÿ',i:[{n:'æ³•æ£',a:'1æ ¹',p:6},{n:'é»„æ²¹',a:'50g',p:4},{n:'è’œæœ«',a:'é€‚é‡',p:0.5}],s:['é»„æ²¹è½¯åŒ–åŠ è’œæœ«','æ³•æ£åˆ‡ç‰‡','æ¶‚æŠ¹è’œé»„æ²¹çƒ¤è‡³é‡‘é»„']},{n:'ç•ªèŒ„æµ“æ±¤',d:'ä¸­ç­‰',t:'20åˆ†é’Ÿ',i:[{n:'ç•ªèŒ„',a:'4ä¸ª',p:8},{n:'æ´‹è‘±',a:'1ä¸ª',p:2},{n:'é²œå¥¶æ²¹',a:'100ml',p:8}],s:['ç•ªèŒ„æ´‹è‘±ç‚’è½¯','åŠ æ°´ç…®çƒ‚','æ…æ‹Œæˆæµ“æ±¤åŠ å¥¶æ²¹']}],
                main:[{n:'ç…ç‰›æ’',d:'ä¸­ç­‰',t:'20åˆ†é’Ÿ',i:[{n:'ç‰›æ’',a:'200g',p:45},{n:'é»„æ²¹',a:'20g',p:2}],s:['ç‰›æ’é€€å†°','ä¸¤é¢ç…åˆ¶','é™ç½®5åˆ†é’Ÿ']},{n:'è’œé¦™ä¸‰æ–‡é±¼',d:'ç®€å•',t:'15åˆ†é’Ÿ',i:[{n:'ä¸‰æ–‡é±¼',a:'200g',p:40},{n:'é»„æ²¹',a:'20g',p:2},{n:'è’œ',a:'2ç“£',p:0.5}],s:['ä¸‰æ–‡é±¼å¸å¹²æ°´','é»„æ²¹ç…åˆ¶','æŒ¤æŸ æª¬æ±']},{n:'çº¢é…’ç‚–ç‰›è‚‰',d:'ä¸­ç­‰',t:'45åˆ†é’Ÿ',i:[{n:'ç‰›è‚‰å—',a:'400g',p:50},{n:'çº¢é…’',a:'200ml',p:20},{n:'èƒ¡èåœ',a:'2ä¸ª',p:4}],s:['ç‰›è‚‰ç…è‡³è¡¨é¢','çº¢é…’ç‚–ç…®1å°æ—¶','åŠ å…¥èƒ¡èåœåœŸè±†']}],
                side:[{n:'è–¯æ¡',d:'ç®€å•',t:'15åˆ†é’Ÿ',i:[{n:'åœŸè±†',a:'3ä¸ª',p:5},{n:'ç›',a:'é€‚é‡',p:0.2}],s:['åœŸè±†åˆ‡æ¡','æ²¹ç‚¸è‡³é‡‘é»„','æ’’ç›è°ƒå‘³']},{n:'ç„—çƒ¤åœŸè±†',d:'ä¸­ç­‰',t:'30åˆ†é’Ÿ',i:[{n:'åœŸè±†',a:'3ä¸ª',p:6},{n:'ç‰›å¥¶',a:'100ml',p:2},{n:'é©¬è‹é‡Œæ‹‰å¥¶é…ª',a:'100g',p:12}],s:['åœŸè±†ç…®ç†Ÿå‹æ³¥','åŠ ç‰›å¥¶é»„æ²¹','æ’’å¥¶é…ªçƒ¤è‡³é‡‘é»„']}],
                dessert:[{n:'ææ‹‰ç±³è‹',d:'ä¸­ç­‰',t:'30åˆ†é’Ÿ',i:[{n:'é©¬æ–¯å¡å½­èŠå£«',a:'250g',p:25},{n:'æ‰‹æŒ‡é¥¼å¹²',a:'200g',p:10},{n:'æµ“ç¼©å’–å•¡',a:'100ml',p:5}],s:['å’–å•¡å†·å´','é¥¼å¹²è˜¸å’–å•¡','èŠå£«å±‚å ç»„è£…']},{n:'ç„¦ç³–å¸ƒä¸',d:'ç®€å•',t:'20åˆ†é’Ÿ',i:[{n:'æ·¡å¥¶æ²¹',a:'200ml',p:8},{n:'è›‹é»„',a:'3ä¸ª',p:3},{n:'ç³–',a:'50g',p:2}],s:['å¥¶æ²¹åŠ çƒ­','æ··åˆè›‹é»„','ç„¦ç³–æ·‹é¢å†·è—']}]
            },
            'ä¸œå—äºšèœ': {
                cold:[{n:'é’æœ¨ç“œæ²™æ‹‰',d:'ä¸­ç­‰',t:'20åˆ†é’Ÿ',i:[{n:'é’æœ¨ç“œ',a:'1ä¸ª',p:8},{n:'ç•ªèŒ„',a:'2ä¸ª',p:4},{n:'èŠ±ç”Ÿ',a:'50g',p:5}],s:['æœ¨ç“œåˆ‡ä¸','ç•ªèŒ„åˆ‡å—','æ‹ŒåŒ€è°ƒå‘³']},{n:'æ³°å¼ç‰›è‚‰æ²™æ‹‰',d:'ä¸­ç­‰',t:'25åˆ†é’Ÿ',i:[{n:'ç‰›è‚‰',a:'150g',p:25},{n:'æ´‹è‘±',a:'1ä¸ª',p:2},{n:'è–„è·',a:'é€‚é‡',p:3}],s:['ç‰›è‚‰ç…®ç†Ÿåˆ‡è–„ç‰‡','æ´‹è‘±åˆ‡ä¸','æ‹ŒåŒ€è°ƒå‘³']}],
                hot:[{n:'æ³°å¼ç»¿å’–å–±é¸¡',d:'ä¸­ç­‰',t:'25åˆ†é’Ÿ',i:[{n:'é¸¡è…¿è‚‰',a:'300g',p:18},{n:'æ¤°æµ†',a:'1ç½',p:12},{n:'ç»¿å’–å–±é…±',a:'2å‹º',p:10}],s:['é¸¡è‚‰åˆ‡å—','æ¤°æµ†ç…®å¼€','åŠ å’–å–±ç‚–ç…®']},{n:'æ³°å¼ç‚’æ²³ç²‰',d:'ä¸­ç­‰',t:'20åˆ†é’Ÿ',i:[{n:'æ²³ç²‰',a:'200g',p:6},{n:'è™¾ä»',a:'100g',p:15},{n:'è±†èŠ½',a:'100g',p:3}],s:['æ²³ç²‰æ³¡è½¯','è™¾ä»ç‚’ç†Ÿ','æ··åˆç¿»ç‚’']},{n:'è¶Šå—ç‰›è‚‰æ²³ç²‰',d:'ä¸­ç­‰',t:'30åˆ†é’Ÿ',i:[{n:'æ²³ç²‰',a:'200g',p:6},{n:'ç‰›è‚‰',a:'150g',p:25},{n:'è±†èŠ½',a:'100g',p:3}],s:['ç‰›è‚‰åˆ‡ç‰‡','éª¨æ±¤ç…®ç²‰','æ‘†ç›˜åŠ æ±¤']}],
                soup:[{n:'æ³°å¼å†¬é˜´åŠŸæ±¤',d:'ä¸­ç­‰',t:'25åˆ†é’Ÿ',i:[{n:'è™¾',a:'200g',p:20},{n:'å†¬é˜´åŠŸé…±',a:'2å‹º',p:8},{n:'æ¤°æµ†',a:'100ml',p:6}],s:['è™¾æ´—å‡€','æ°´å¼€åŠ é…±','ä¸‹è™¾ç…®ç†Ÿ']},{n:'è¶Šå¼ç‰›è‚‰æ±¤',d:'ä¸­ç­‰',t:'30åˆ†é’Ÿ',i:[{n:'ç‰›è‚‰',a:'200g',p:28},{n:'æ²³ç²‰',a:'200g',p:6}],s:['ç‰›è‚‰ç…®æ±¤','æ²³ç²‰ç…®ç†Ÿ','è£…ç¢—åŠ æ±¤']}],
                staple:[{n:'æ³°å¼è èç‚’é¥­',d:'ä¸­ç­‰',t:'20åˆ†é’Ÿ',i:[{n:'è è',a:'1ä¸ª',p:8},{n:'ç±³é¥­',a:'1ç¢—',p:2},{n:'è™¾ä»',a:'100g',p:15}],s:['è èæŒ–è‚‰','ç±³é¥­ç‚’é¦™','æ··åˆç¿»ç‚’']},{n:'èŠ’æœç³¯ç±³é¥­',d:'ç®€å•',t:'15åˆ†é’Ÿ',i:[{n:'èŠ’æœ',a:'1ä¸ª',p:10},{n:'ç³¯ç±³',a:'200g',p:4},{n:'æ¤°æµ†',a:'100ml',p:6}],s:['ç³¯ç±³ç…®ç†Ÿ','èŠ’æœåˆ‡å—','æ‘†ç›˜æ·‹æ¤°æµ†']}]
            }
        };

        function generateMenu() {
            if (!selectedType) { document.getElementById('typeError').classList.add('show'); return; }

            window.menuGroups = {};
            const usedRecipeNames = new Set(); // ç”¨äºå»é‡ï¼Œè®°å½•å·²é€‰ä¸­çš„èœå

            const ingStr = document.getElementById('ingredients').value;
            const ingList = ingStr ? ingStr.split(',').map(s => s.trim()).filter(s => s) : [];
            const data = recipes[selectedType];
            let result = [];

            // è¾…åŠ©å‡½æ•°ï¼šä»æ± å­ä¸­é€‰æ‹©æŒ‡å®šæ•°é‡çš„èœï¼Œå¼ºåˆ¶åŒ…å«åŒ¹é…ç°æœ‰é£Ÿæçš„èœ
            let noMatchWarning = '';
            function selectRecipes(pool, need, catKey, catName) {
                if (need <= 0 || !pool.length) return [];

                // è¿‡æ»¤æ‰å·²ç»é€‰è¿‡çš„èœ
                const availablePool = pool.filter(r => !usedRecipeNames.has(r.n));
                if (availablePool.length === 0) return [];

                // æ‰¾å‡ºåŒ¹é…ç°æœ‰é£Ÿæçš„èœ
                const matched = availablePool.filter(r => ingList.some(ing => r.i.some(i => i.n.includes(ing))));
                const other = availablePool.filter(r => !matched.includes(r));

                // å¦‚æœè¾“å…¥äº†é£Ÿæä½†æ²¡æœ‰åŒ¹é…çš„èœï¼Œè®°å½•è­¦å‘Š
                if (ingList.length > 0 && matched.length === 0) {
                    noMatchWarning = `æœªåœ¨${catName}ä¸­æ‰¾åˆ°åŒ…å« [${ingList.join(', ')}] çš„èœå“ï¼Œå·²æ¨èå…¶ä»–èœå“`;
                }

                // å¦‚æœæ± å­é‡Œçš„èœä¸å¤Ÿï¼Œç›´æ¥è¿”å›æ‰€æœ‰
                if (availablePool.length <= need) {
                    availablePool.forEach(r => usedRecipeNames.add(r.n));
                    return availablePool.map(r => ({...r, cat: catKey, catName}));
                }

                const selected = [];
                const matchedShuffled = matched.sort(() => 0.5 - Math.random());
                const otherShuffled = other.sort(() => 0.5 - Math.random());

                // 1. å¿…é¡»åŒ…å«æ‰€æœ‰åŒ¹é…ç°æœ‰é£Ÿæçš„èœ
                selected.push(...matchedShuffled);
                matched.forEach(r => usedRecipeNames.add(r.n));

                // 2. ç”¨å…¶ä»–èœè¡¥è¶³åˆ° need æ•°é‡
                if (selected.length < need) {
                    for (let i = 0; i < otherShuffled.length && selected.length < need; i++) {
                        selected.push(otherShuffled[i]);
                        usedRecipeNames.add(otherShuffled[i].n);
                    }
                }

                // 3. å¦‚æœåŒ¹é…çš„æ•°é‡è¶…è¿‡ needï¼Œéšæœºæˆªå–
                if (selected.length > need) {
                    const shuffled = selected.sort(() => 0.5 - Math.random());
                    return shuffled.slice(0, need).map(r => ({...r, cat: catKey, catName}));
                }

                return selected.map(r => ({...r, cat: catKey, catName}));
            }

            if (selectedType === 'ä¸­å¼ç‚’èœ') {
                const counts = stirCounts;
                // å‡‰èœ
                result.push(...selectRecipes(data.cold, counts.cold, 'cold', 'å‡‰èœ'));

                // çƒ­èœç‰¹æ®Šé€»è¾‘ï¼š1ä»½ä¼˜å…ˆå¤§è¤ï¼Œ>=2ä»½è¤ç´ æ­é…
                if (counts.hot > 0) {
                    const hotMeat = data.hotMeat || [];
                    const hotVeg = data.hot || [];

                    if (counts.hot === 1) {
                        // åªæ¨èå¤§è¤
                        result.push(...selectRecipes(hotMeat, 1, 'hot', 'çƒ­èœ'));
                    } else {
                        // è¤ç´ æ­é…
                        const meatCount = Math.ceil(counts.hot / 2);
                        const vegCount = counts.hot - meatCount;
                        result.push(...selectRecipes(hotMeat, meatCount, 'hot', 'çƒ­èœ'));
                        result.push(...selectRecipes(hotVeg, vegCount, 'hot', 'çƒ­èœ'));
                    }
                }

                // æ±¤ã€ä¸»é£Ÿ
                result.push(...selectRecipes(data.soup, counts.soup, 'soup', 'æ±¤'));
                result.push(...selectRecipes(data.staple, counts.staple, 'staple', 'ä¸»é£Ÿ'));
            } else if (selectedType === 'ä¸œå—äºšèœ') {
                const counts = stirCounts;
                const cats = [
                    {k:'cold', n:'å‡‰èœ', need: counts.cold},
                    {k:'hot', n:'çƒ­èœ', need: counts.hot},
                    {k:'soup', n:'æ±¤', need: counts.soup},
                    {k:'staple', n:'ä¸»é£Ÿ', need: counts.staple}
                ];

                cats.forEach(cat => {
                    result.push(...selectRecipes(data[cat.k], cat.need, cat.k, cat.n));
                });
            } else if (selectedType === 'ç«é”…' || selectedType === 'çƒ§çƒ¤') {
                const counts = hotpotCounts;
                const cats = [
                    {k:'meat', n:'è¤ç±»', need: counts.meat},
                    {k:'veg', n:'ç´ ç±»', need: counts.veg},
                    {k:'staple', n:'ä¸»é£Ÿ', need: counts.stapleH}
                ];

                cats.forEach(cat => {
                    result.push(...selectRecipes(data[cat.k], cat.need, cat.k, cat.n));
                });
            } else if (selectedType === 'è¥¿é¤') {
                const counts = westernCounts;
                const cats = [
                    {k:'appetizer', n:'å‰èœ', need: counts.appetizer},
                    {k:'main', n:'ä¸»èœ', need: counts.main},
                    {k:'side', n:'å°é£Ÿ', need: counts.side},
                    {k:'dessert', n:'ç”œç‚¹', need: counts.dessert}
                ];

                cats.forEach(cat => {
                    result.push(...selectRecipes(data[cat.k], cat.need, cat.k, cat.n));
                });
            }

            // è¾“å‡º
            let html = '';
            const groups = {};
            result.forEach(r => {
                if (!groups[r.catName]) groups[r.catName] = [];
                groups[r.catName].push(r);
            });

            // ç”Ÿæˆè´­èœæ¸…å•
            const ingredientMap = {}; // é£Ÿæåç§° -> {amount, price, isMain}
            const seasoningMap = {}; // è°ƒæ–™åç§° -> {count}

            result.forEach(r => {
                r.i.forEach(item => {
                    const name = item.n;
                    const isSeasoning = ['ç›','ç³–','é…±æ²¹','é†‹','é¦™æ²¹','èƒ¡æ¤’','å­œç„¶','è¾£æ¤’','èŠ±æ¤’','è’œ','å§œ','è‘±','æ–™é…’','èšæ²¹','ç•ªèŒ„é…±','æ²™æ‹‰é…±','é»„æ²¹','æ©„æ¦„æ²¹','æ¤°æµ†','å†¬é˜´åŠŸé…±','ç»¿å’–å–±é…±','çº¢å’–å–±é…±','æ²™å—²é…±','é±¼éœ²','é¦™èŒ…','è–„è·','æ¬§èŠ¹','è¿·è¿­é¦™','èŠå£«','å¥¶é…ª','å¥¶æ²¹','ç‰›å¥¶','é¢ç²‰','é¢åŒ…ç³ ','æ·€ç²‰','å‰åˆ—ä¸','æµ“ç¼©å’–å•¡'].some(s => name.includes(s));

                    if (isSeasoning) {
                        if (!seasoningMap[name]) seasoningMap[name] = {count: 0};
                        seasoningMap[name].count++;
                    } else {
                        if (!ingredientMap[name]) ingredientMap[name] = {amount: item.a, price: 0, isMain: ['è‚‰','é¸¡','ç‰›','ç¾Š','çŒª','è™¾','é±¼','è›‹','è±†è…','èœ','èœå¿ƒ','ç”Ÿèœ','åœŸè±†','ç•ªèŒ„','é»„ç“œ','æœ¨è€³','è—•'].some(m => name.includes(m))};
                        ingredientMap[name].price += item.p;
                    }
                });
            });

            // æ’åºï¼šè¤åˆ°ç´ ï¼Œç”±æ ¸å¿ƒåˆ°æ¬¡è¦
            const sortedIngredients = Object.entries(ingredientMap)
                .sort((a, b) => {
                    if (a[1].isMain && !b[1].isMain) return -1;
                    if (!a[1].isMain && b[1].isMain) return 1;
                    return b[1].price - a[1].price;
                });

            Object.keys(groups).forEach((catName, idx) => {
                const catEmoji = {
                    'å‡‰èœ': 'ğŸ¥—', 'çƒ­èœ': 'ğŸ³', 'æ±¤': 'ğŸ²', 'ä¸»é£Ÿ': 'ğŸš',
                    'è¤ç±»': 'ğŸ¥©', 'ç´ ç±»': 'ğŸ¥¬',
                    'å‰èœ': 'ğŸ¥—', 'ä¸»èœ': 'ğŸ½ï¸', 'å°é£Ÿ': 'ğŸŸ', 'ç”œç‚¹': 'ğŸ°'
                }[catName] || '';
                html += `<h3 class="result-group-title">${catEmoji} ${catName}</h3>`;
                html += groups[catName].map((r, i) => {
                    const isAdded = window.myMenu.some(m => m.n === r.n);
                    if (isAdded) {
                        return `<div class="recipe-card" data-cat="${catName}" data-idx="${i}"><div class="recipe-info"><div class="recipe-header"><span class="recipe-name">${r.n}</span><button class="menu-action-btn added">âœ“</button></div><div class="recipe-meta">${r.t} Â· ${r.d}</div><div class="recipe-price">Â¥${r.i.reduce((s,i)=>s+i.p,0)}</div></div><div class="recipe-img-placeholder"><img src="https://images.unsplash.com/photo-1546069901-ba9599a7e63c?w=150&h=150&fit=crop" alt="èœå“å›¾ç‰‡"></div></div>`;
                    }
                    return `<div class="recipe-card" data-cat="${catName}" data-idx="${i}"><div class="recipe-info"><div class="recipe-header"><span class="recipe-name">${r.n}</span><button class="menu-action-btn">+</button></div><div class="recipe-meta">${r.t} Â· ${r.d}</div><div class="recipe-price">Â¥${r.i.reduce((s,i)=>s+i.p,0)}</div></div><div class="recipe-img-placeholder"><img src="https://images.unsplash.com/photo-1546069901-ba9599a7e63c?w=150&h=150&fit=crop" alt="èœå“å›¾ç‰‡"></div></div>`;
                }).join('');
                window.menuGroups[catName] = groups[catName];
            });

            // æ˜¾ç¤ºè­¦å‘Šï¼ˆå¦‚æœè¾“å…¥äº†é£Ÿæä½†æ²¡æœ‰åŒ¹é…ï¼‰
            if (noMatchWarning) {
                html = `<div class="warning-msg">${noMatchWarning}</div>` + html;
            }

            // åªæ˜¾ç¤ºæ¨èèœå•
            document.getElementById('resultContent').innerHTML = html || '<p style="text-align:center;color:#999;padding:20px;">æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„èœè°±</p>';
            document.getElementById('resultCard').classList.add('show');

            // ç»‘å®šæŒ‰é’®äº‹ä»¶
            updateAllButtonStates();
        }

        // é¡µé¢åˆ‡æ¢å‡½æ•°
        function goToMenuPage() {
            if (!selectedType) { document.getElementById('typeError').classList.add('show'); return; }
            generateMenu();
            document.getElementById('inputPage').classList.remove('active');
            document.getElementById('menuPage').classList.add('active');
            document.getElementById('myMenuBar').style.display = 'flex';
            updateMyMenuCount();
        }

        function goToInputPage() {
            document.getElementById('menuPage').classList.remove('active');
            document.getElementById('inputPage').classList.add('active');
            document.getElementById('myMenuBar').style.display = 'none';
        }

        function refreshMenu() {
            if (selectedType) {
                // é‡æ–°ç”Ÿæˆèœå•
                window.menuGroups = {};
                const usedRecipeNames = new Set(); // ç”¨äºå»é‡ï¼Œè®°å½•å·²é€‰ä¸­çš„èœå
                const ingStr = document.getElementById('ingredients').value;
                const ingList = ingStr ? ingStr.split(',').map(s => s.trim()).filter(s => s) : [];
                const data = recipes[selectedType];
                let result = [];
                let noMatchWarning = '';

                function selectRecipes(pool, need, catKey, catName) {
                    if (need <= 0 || !pool.length) return [];

                    // è¿‡æ»¤æ‰å·²ç»é€‰è¿‡çš„èœ
                    const availablePool = pool.filter(r => !usedRecipeNames.has(r.n));
                    if (availablePool.length === 0) return [];

                    const matched = availablePool.filter(r => ingList.some(ing => r.i.some(i => i.n.includes(ing))));
                    const other = availablePool.filter(r => !matched.includes(r));
                    if (ingList.length > 0 && matched.length === 0) {
                        noMatchWarning = `æœªåœ¨${catName}ä¸­æ‰¾åˆ°åŒ…å« [${ingList.join(', ')}] çš„èœå“ï¼Œå·²æ¨èå…¶ä»–èœå“`;
                    }
                    if (availablePool.length <= need) {
                        availablePool.forEach(r => usedRecipeNames.add(r.n));
                        return availablePool.map(r => ({...r, cat: catKey, catName}));
                    }
                    const matchedShuffled = matched.sort(() => 0.5 - Math.random());
                    const otherShuffled = other.sort(() => 0.5 - Math.random());
                    const selected = [...matchedShuffled];
                    matched.forEach(r => usedRecipeNames.add(r.n));
                    for (let i = 0; i < otherShuffled.length && selected.length < need; i++) {
                        selected.push(otherShuffled[i]);
                        usedRecipeNames.add(otherShuffled[i].n);
                    }
                    if (selected.length > need) {
                        const shuffled = selected.sort(() => 0.5 - Math.random());
                        return shuffled.slice(0, need).map(r => ({...r, cat: catKey, catName}));
                    }
                    return selected.map(r => ({...r, cat: catKey, catName}));
                }

                // æ ¹æ®ç±»å‹é€‰æ‹©èœè°±
                if (selectedType === 'ä¸­å¼ç‚’èœ' || selectedType === 'ä¸œå—äºšèœ') {
                    const counts = stirCounts;
                    result.push(...selectRecipes(data.cold, counts.cold, 'cold', 'å‡‰èœ'));
                    if (counts.hot > 0) {
                        const hotMeat = data.hotMeat || [];
                        const hotVeg = data.hot || [];
                        if (counts.hot === 1) {
                            result.push(...selectRecipes(hotMeat, 1, 'hot', 'çƒ­èœ'));
                        } else {
                            const meatCount = Math.ceil(counts.hot / 2);
                            const vegCount = counts.hot - meatCount;
                            result.push(...selectRecipes(hotMeat, meatCount, 'hot', 'çƒ­èœ'));
                            result.push(...selectRecipes(hotVeg, vegCount, 'hot', 'çƒ­èœ'));
                        }
                    }
                    result.push(...selectRecipes(data.soup, counts.soup, 'soup', 'æ±¤'));
                    result.push(...selectRecipes(data.staple, counts.staple, 'staple', 'ä¸»é£Ÿ'));
                } else if (selectedType === 'ç«é”…' || selectedType === 'çƒ§çƒ¤') {
                    const counts = hotpotCounts;
                    result.push(...selectRecipes(data.meat, counts.meat, 'meat', 'è¤ç±»'));
                    result.push(...selectRecipes(data.veg, counts.veg, 'veg', 'ç´ ç±»'));
                    result.push(...selectRecipes(data.staple, counts.stapleH, 'staple', 'ä¸»é£Ÿ'));
                } else if (selectedType === 'è¥¿é¤') {
                    const counts = westernCounts;
                    const cats = [
                        {k:'appetizer', n:'å‰èœ', need: counts.appetizer},
                        {k:'main', n:'ä¸»èœ', need: counts.main},
                        {k:'side', n:'å°é£Ÿ', need: counts.side},
                        {k:'dessert', n:'ç”œç‚¹', need: counts.dessert}
                    ];
                    cats.forEach(cat => {
                        result.push(...selectRecipes(data[cat.k], cat.need, cat.k, cat.n));
                    });
                }

                // ç”ŸæˆHTML
                let html = '';
                const groups = {};
                result.forEach(r => {
                    if (!groups[r.catName]) groups[r.catName] = [];
                    groups[r.catName].push(r);
                });

                Object.keys(groups).forEach((catName, idx) => {
                    const catEmoji = {
                        'å‡‰èœ': 'ğŸ¥—', 'çƒ­èœ': 'ğŸ³', 'æ±¤': 'ğŸ²', 'ä¸»é£Ÿ': 'ğŸš',
                        'è¤ç±»': 'ğŸ¥©', 'ç´ ç±»': 'ğŸ¥¬',
                        'å‰èœ': 'ğŸ¥—', 'ä¸»èœ': 'ğŸ½ï¸', 'å°é£Ÿ': 'ğŸŸ', 'ç”œç‚¹': 'ğŸ°'
                    }[catName] || '';
                    html += `<h3 class="result-group-title">${catEmoji} ${catName}</h3>`;
                    html += groups[catName].map((r, i) => {
                        const isAdded = window.myMenu.some(m => m.n === r.n);
                        if (isAdded) {
                            return `<div class="recipe-card" data-cat="${catName}" data-idx="${i}"><div class="recipe-info"><div class="recipe-header"><span class="recipe-name">${r.n}</span><button class="menu-action-btn added">âœ“</button></div><div class="recipe-meta">${r.t} Â· ${r.d}</div><div class="recipe-price">Â¥${r.i.reduce((s,i)=>s+i.p,0)}</div></div><div class="recipe-img-placeholder"><img src="https://images.unsplash.com/photo-1546069901-ba9599a7e63c?w=150&h=150&fit=crop" alt="èœå“å›¾ç‰‡"></div></div>`;
                        }
                        return `<div class="recipe-card" data-cat="${catName}" data-idx="${i}"><div class="recipe-info"><div class="recipe-header"><span class="recipe-name">${r.n}</span><button class="menu-action-btn">+</button></div><div class="recipe-meta">${r.t} Â· ${r.d}</div><div class="recipe-price">Â¥${r.i.reduce((s,i)=>s+i.p,0)}</div></div><div class="recipe-img-placeholder"><img src="https://images.unsplash.com/photo-1546069901-ba9599a7e63c?w=150&h=150&fit=crop" alt="èœå“å›¾ç‰‡"></div></div>`;
                    }).join('');
                    window.menuGroups[catName] = groups[catName];
                });

                if (noMatchWarning) {
                    html = `<div class="warning-msg">${noMatchWarning}</div>` + html;
                }

                document.getElementById('resultContent').innerHTML = html;

                // ç»‘å®šæŒ‰é’®äº‹ä»¶å¹¶æ›´æ–°çŠ¶æ€
                updateAllButtonStates();
            }
        }

        // æ›´æ–°æ‰€æœ‰æŒ‰é’®çŠ¶æ€
        function updateAllButtonStates() {
            const typeMap = {
                'å‡‰èœ': 'cold', 'çƒ­èœ': 'hot', 'æ±¤': 'soup', 'ä¸»é£Ÿ': 'staple',
                'è¤ç±»': 'meat', 'ç´ ç±»': 'veg', 'å‰èœ': 'appetizer', 'ä¸»èœ': 'main', 'å°é£Ÿ': 'side', 'ç”œç‚¹': 'dessert'
            };

            const allCards = document.querySelectorAll('#resultContent .recipe-card');
            allCards.forEach((card) => {
                const nameSpan = card.querySelector('.recipe-name');
                const btn = card.querySelector('.menu-action-btn');
                if (!nameSpan || !btn) return;

                const name = nameSpan.textContent;
                const catName = card.getAttribute('data-cat');
                const isAdded = window.myMenu.some(m => m.n === name);

                if (isAdded) {
                    btn.textContent = 'âœ“';
                    btn.className = 'menu-action-btn added';
                    btn.onclick = function(e) {
                        e.stopPropagation();
                        removeFromMenuByName(name);
                    };
                } else {
                    const typeKey = typeMap[catName];
                    const presetCountEl = typeKey ? document.getElementById(typeKey + 'Val') : null;
                    const presetCount = presetCountEl ? parseInt(presetCountEl.textContent) : 0;
                    const currentCount = window.myMenu.filter(m => {
                        if (typeMap[m.catName] === typeKey) return true;
                        if (m.cat === typeKey) return true;
                        return false;
                    }).length;

                    if (presetCountEl && currentCount >= presetCount) {
                        btn.textContent = 'æ¢æˆå®ƒ';
                        btn.className = 'menu-action-btn replace';
                        btn.onclick = function(e) {
                            e.stopPropagation();
                            // æ‰¾åˆ°è¯¥èœåœ¨menuGroupsä¸­çš„ä½ç½®
                            let foundCatIdx = -1, foundItemIdx = -1;
                            let i = 0;
                            for (const cn in window.menuGroups) {
                                const foundIdx = window.menuGroups[cn].findIndex(m => m.n === name);
                                if (foundIdx >= 0) {
                                    foundCatIdx = i;
                                    foundItemIdx = foundIdx;
                                    break;
                                }
                                i++;
                            }
                            // æ‰¾åˆ°å½“å‰ç±»å‹å·²åŠ å…¥çš„èœ
                            const sameTypeItems = window.myMenu.filter(m => {
                                if (typeMap[m.catName] === typeKey) return true;
                                if (m.cat === typeKey) return true;
                                return false;
                            });
                            // å¦‚æœåªæœ‰ä¸€é“ï¼Œç›´æ¥æ›¿æ¢æœ€å…ˆåŠ å…¥çš„
                            if (sameTypeItems.length === 1) {
                                const oldName = sameTypeItems[0].n;
                                const oldIdx = window.myMenu.findIndex(m => m.n === oldName);
                                if (oldIdx >= 0) {
                                    // æ‰¾åˆ°æ–°èœ
                                    const newRecipe = window.menuGroups[catName].find(m => m.n === name);
                                    if (newRecipe) {
                                        window.myMenu.splice(oldIdx, 1, newRecipe);
                                        updateAllButtonStates();
                                        updateMyMenuCount();
                                        return;
                                    }
                                }
                            }
                            // å¤šäºä¸€é“æ—¶æ‰“å¼€å¼¹çª—
                            openSwapModal(name, catName, foundCatIdx, foundItemIdx);
                        };
                    } else {
                        btn.textContent = '+';
                        btn.className = 'menu-action-btn';
                        btn.onclick = function(e) {
                            e.stopPropagation();
                            addToMenuByName(name);
                        };
                    }
                }
            });
        }

        // é€šè¿‡èœåæ·»åŠ åˆ°èœå•
        function addToMenuByName(name) {
            for (const catName in window.menuGroups) {
                const recipe = window.menuGroups[catName].find(m => m.n === name);
                if (recipe) {
                    if (window.myMenu.some(m => m.n === recipe.n)) return;
                    window.myMenu.push(recipe);
                    updateAllButtonStates();
                    updateMyMenuCount();
                    return;
                }
            }
        }

        // é€šè¿‡èœåä»èœå•ç§»é™¤
        function removeFromMenuByName(name) {
            const idx = window.myMenu.findIndex(m => m.n === name);
            if (idx >= 0) {
                window.myMenu.splice(idx, 1);
                updateAllButtonStates();
                updateMyMenuCount();
            }
        }

        function openMyMenuPage() {
            renderMyMenuDetail();
            document.getElementById('myMenuPage').classList.add('show');
            document.getElementById('myMenuOverlay').classList.add('show');
        }

        function closeMyMenuPage() {
            document.getElementById('myMenuPage').classList.remove('show');
            document.getElementById('myMenuOverlay').classList.remove('show');
        }

        function updateMyMenuCount() {
            const count = window.myMenu ? window.myMenu.length : 0;
            document.getElementById('myMenuCount').textContent = `(${count})`;
        }

        // å…¨éƒ¨åŠ å…¥
        function addAllToMenu() {
            if (!window.menuGroups || Object.keys(window.menuGroups).length === 0) return;

            // æ¸…ç©ºmyMenu
            window.myMenu = [];

            // æ·»åŠ æ‰€æœ‰å½“å‰æ¨èçš„èœ
            for (const catName in window.menuGroups) {
                const recipes = window.menuGroups[catName];
                recipes.forEach(recipe => {
                    window.myMenu.push(recipe);
                });
            }

            // æ›´æ–°ç•Œé¢
            updateAllButtonStates();
            updateMyMenuCount();
        }

        // æ¸²æŸ“æˆ‘çš„èœå•è¯¦æƒ…é¡µ
        function renderMyMenuDetail() {
            if (!window.myMenu || window.myMenu.length === 0) {
                document.getElementById('myMenuContent').innerHTML = '<p style="text-align:center;color:#999;padding:40px 20px;">è¿˜æ²¡æœ‰æ·»åŠ ä»»ä½•èœå“</p>';
                return;
            }

            // æŒ‰ç±»å‹åˆ†ç»„
            const groups = {};
            window.myMenu.forEach(r => {
                const catName = r.catName || 'å…¶ä»–';
                if (!groups[catName]) groups[catName] = [];
                groups[catName].push(r);
            });

            // åˆ†ç±»æ˜¾ç¤ºèœå“
            const typeEmoji = {
                'å‡‰èœ': 'ğŸ¥—', 'çƒ­èœ': 'ğŸ³', 'æ±¤': 'ğŸ²', 'ä¸»é£Ÿ': 'ğŸš',
                'è¤ç±»': 'ğŸ¥©', 'ç´ ç±»': 'ğŸ¥¬', 'å‰èœ': 'ğŸ¥—', 'ä¸»èœ': 'ğŸ½ï¸', 'å°é£Ÿ': 'ğŸŸ', 'ç”œç‚¹': 'ğŸ°'
            };

            let menuHtml = '';
            for (const catName in groups) {
                menuHtml += `<h3 class="result-group-title">${typeEmoji[catName] || ''} ${catName}</h3>`;
                menuHtml += `<div class="my-menu-grid">`;
                groups[catName].forEach((r, idx) => {
                    // æ‰¾åˆ°åœ¨myMenuä¸­çš„å®é™…ç´¢å¼•
                    const actualIdx = window.myMenu.findIndex(m => m.n === r.n);
                    menuHtml += `<div class="my-menu-grid-item">
                        <button class="my-menu-item-remove" onclick="removeFromMenu(${actualIdx})">âˆ’</button>
                        <div class="my-menu-item-name">${r.n}</div>
                        <div class="my-menu-item-meta">${r.t}</div>
                    </div>`;
                });
                menuHtml += `</div>`;
            }

            // è®¡ç®—å¤‡èœæ¸…å•å’Œè°ƒæ–™æ¸…å•
            const ingredientMap = {};
            const seasoningMap = {};

            window.myMenu.forEach(r => {
                r.i.forEach(item => {
                    const name = item.n;
                    const isSeasoning = ['ç›','ç³–','é…±æ²¹','é†‹','é¦™æ²¹','èƒ¡æ¤’','å­œç„¶','è¾£æ¤’','èŠ±æ¤’','è’œ','å§œ','è‘±','æ–™é…’','èšæ²¹','ç•ªèŒ„é…±','æ²™æ‹‰é…±','é»„æ²¹','æ©„æ¦„æ²¹','æ¤°æµ†','å†¬é˜´åŠŸé…±','ç»¿å’–å–±é…±','çº¢å’–å–±é…±','æ²™å—²é…±','é±¼éœ²','é¦™èŒ…','è–„è·','æ¬§èŠ¹','è¿·è¿­é¦™','èŠå£«','å¥¶é…ª','å¥¶æ²¹','ç‰›å¥¶','é¢ç²‰','é¢åŒ…ç³ ','æ·€ç²‰','å‰åˆ—ä¸','æµ“ç¼©å’–å•¡'].some(s => name.includes(s));

                    if (isSeasoning) {
                        if (!seasoningMap[name]) seasoningMap[name] = {count: 0};
                        seasoningMap[name].count++;
                    } else {
                        if (!ingredientMap[name]) ingredientMap[name] = {amount: item.a, price: 0, isMain: ['è‚‰','é¸¡','ç‰›','ç¾Š','çŒª','è™¾','é±¼','è›‹','è±†è…','èœ','èœå¿ƒ','ç”Ÿèœ','åœŸè±†','ç•ªèŒ„','é»„ç“œ','æœ¨è€³','è—•'].some(m => name.includes(m))};
                        ingredientMap[name].price += item.p;
                    }
                });
            });

            const sortedIngredients = Object.entries(ingredientMap)
                .sort((a, b) => {
                    if (a[1].isMain && !b[1].isMain) return -1;
                    if (!a[1].isMain && b[1].isMain) return 1;
                    return b[1].price - a[1].price;
                });
            const sortedSeasonings = Object.entries(seasoningMap)
                .sort((a, b) => b[1].count - a[1].count);
            const totalAmount = sortedIngredients.reduce((sum, [_, data]) => sum + data.price, 0);

            // é¢„ä¼°æ€»é‡‘é¢ï¼ˆæ–‡æœ¬æ ·å¼ï¼Œæ”¾åœ¨é¡¶éƒ¨ï¼‰
            let totalHtml = '';
            if (sortedIngredients.length > 0) {
                totalHtml = `<div class="my-menu-total">é¢„ä¼°æ€»é‡‘é¢ï¼š<span>Â¥${totalAmount.toFixed(1)}</span></div>`;
            }

            document.getElementById('myMenuContent').innerHTML = totalHtml + menuHtml;
            updateMyMenuCount();
        }

        // åŠ å…¥èœå•
        function addToMenu(catIdx, itemIdx) {
            const catName = Object.keys(window.menuGroups)[catIdx];
            const recipe = window.menuGroups[catName][itemIdx];

            // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
            if (window.myMenu.some(m => m.n === recipe.n)) {
                return;
            }

            // åˆ¤æ–­èœå“ç±»å‹å’Œé¢„è®¾æ•°é‡
            const typeMap = {
                'å‡‰èœ': 'cold',
                'çƒ­èœ': 'hot',
                'æ±¤': 'soup',
                'ä¸»é£Ÿ': 'staple',
                'è¤ç±»': 'meat',
                'ç´ ç±»': 'veg',
                'å‰èœ': 'appetizer',
                'ä¸»èœ': 'main',
                'å°é£Ÿ': 'side',
                'ç”œç‚¹': 'dessert'
            };

            let typeKey = typeMap[catName];
            let presetCountEl = typeKey ? document.getElementById(typeKey + 'Val') : null;
            let presetCount = presetCountEl ? parseInt(presetCountEl.textContent) : 0;

            // å¦‚æœæ²¡æœ‰æ‰¾åˆ°é¢„è®¾æ•°é‡ï¼Œå°è¯•ä½¿ç”¨ recipe.cat (ç«é”…/çƒ§çƒ¤ç±»å‹)
            if (!presetCountEl && recipe.cat) {
                typeKey = recipe.cat;
                presetCountEl = document.getElementById(typeKey + 'Val');
                presetCount = presetCountEl ? parseInt(presetCountEl.textContent) : 0;
            }

            // ç»Ÿè®¡å½“å‰å·²æ·»åŠ çš„è¯¥ç±»å‹æ•°é‡
            let currentCount = 0;
            if (typeKey) {
                currentCount = window.myMenu.filter(m => {
                    if (typeMap[m.catName] === typeKey) return true;
                    if (m.cat === typeKey) return true;
                    return false;
                }).length;
            }

            if (presetCountEl && currentCount >= presetCount) {
                // è¶…å‡ºé¢„è®¾æ•°é‡ï¼Œæ˜¾ç¤ºç¡®è®¤å¼¹çª—
                pendingRecipe = recipe;
                showConfirmModal(catName, typeKey);
            } else {
                // æœªè¶…å‡ºï¼Œç›´æ¥æ·»åŠ 
                addRecipeToMenu(recipe);
            }
        }

        // æ·»åŠ èœå“åˆ°èœå•ï¼ˆå®é™…æ‰§è¡Œæ·»åŠ çš„å‡½æ•°ï¼‰
        function addRecipeToMenu(recipe) {
            window.myMenu.push(recipe);
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            updateAllButtonStates();
            updateMyMenuCount();
        }

        // ä»èœå•ç§»é™¤
        function removeFromMenu(idx) {
            if (idx < 0 || idx >= window.myMenu.length) return;
            window.myMenu.splice(idx, 1);
            // é‡æ–°æ¸²æŸ“æˆ‘çš„èœå•å¼¹å±‚
            renderMyMenuDetail();
            // æ›´æ–°æ¨èèœå•ä¸­çš„æŒ‰é’®çŠ¶æ€
            updateAllButtonStates();
            updateMyMenuCount();
        }

        function showDetail(catIdx, itemIdx) {
            const catName = Object.keys(window.menuGroups)[catIdx];
            const r = window.menuGroups[catName][itemIdx];
            const total = r.i.reduce((s,i)=>s+i.p,0);
            document.getElementById('modalContent').innerHTML = `
                <button class="modal-close" onclick="closeDetail()">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 6L6 18M6 6l12 12"/>
                    </svg>
                </button>
                <div class="modal-section">
                    <h2>${r.n}</h2>
                    <div class="info-row">
                        <span>${r.t}</span>
                        <span>${r.d}</span>
                    </div>
                </div>
                <div class="modal-section">
                    <h3 class="modal-title">é£Ÿææ¸…å•</h3>
                    ${r.i.map(i=>`<div class="modal-row"><span>${i.n} ${i.a}</span><span>Â¥${i.p}</span></div>`).join('')}
                    <div class="modal-row total"><span>åˆè®¡</span><span>Â¥${total}</span></div>
                </div>
                <div class="modal-section">
                    <h3 class="modal-title">åˆ¶ä½œæ­¥éª¤</h3>
                    ${r.s.map((st,i)=>`<div class="modal-step"><span class="step-num">${i+1}</span><span>${st}</span></div>`).join('')}
                </div>`;
            document.getElementById('detailModal').classList.add('show');
        }
        function closeDetail() { document.getElementById('detailModal').classList.remove('show'); }
        document.getElementById('detailModal').addEventListener('click', e => { if(e.target.id==='detailModal') closeDetail(); });

        // æ¢èœå¼¹çª—ç›¸å…³å‡½æ•°
        function openSwapModal(recipeName, catName, catIdx, itemIdx) {
            const typeMap = {
                'å‡‰èœ': 'cold', 'çƒ­èœ': 'hot', 'æ±¤': 'soup', 'ä¸»é£Ÿ': 'staple',
                'è¤ç±»': 'meat', 'ç´ ç±»': 'veg', 'å‰èœ': 'appetizer', 'ä¸»èœ': 'main', 'å°é£Ÿ': 'side', 'ç”œç‚¹': 'dessert'
            };
            const typeKey = typeMap[catName];

            // è·å–åŒç±»å‹å·²åŠ å…¥çš„èœ
            const sameTypeMenu = window.myMenu.filter(m => {
                // æ£€æŸ¥ m.catNameï¼ˆå­—ç¬¦ä¸²ï¼‰å’Œ typeKey æ˜¯å¦åŒ¹é…
                if (m.catName === catName) return true;
                // æ£€æŸ¥ m.cat å’Œ typeKey æ˜¯å¦åŒ¹é…
                if (m.cat === typeKey) return true;
                // æ£€æŸ¥ typeMap[m.catName] æ˜¯å¦ç­‰äº typeKey
                if (typeMap[m.catName] === typeKey) return true;
                return false;
            });

            // ç”Ÿæˆæ¢èœåˆ—è¡¨
            let swapListHtml = '';
            if (sameTypeMenu.length > 0) {
                sameTypeMenu.forEach((r, idx) => {
                    swapListHtml += `<div class="swap-item" onclick="selectSwapItem(${idx})" data-idx="${idx}">
                        <div class="swap-item-name">${r.n}</div>
                        <div class="swap-item-meta">${r.t}</div>
                    </div>`;
                });
            } else {
                swapListHtml = '<p style="text-align:center;color:#999;padding:20px;">æ²¡æœ‰åŒç±»å‹çš„èœå¯ä»¥æ›¿æ¢</p>';
            }

            document.getElementById('swapList').innerHTML = swapListHtml;
            selectedSwapIndex = -1;
            document.getElementById('swapConfirmBtn').disabled = true;

            // ä¿å­˜å¾…æ¢å…¥çš„èœä¿¡æ¯
            pendingSwapRecipe = { name: recipeName, catName, cat: typeKey, catKey: typeKey };
            pendingSwapTypeKey = typeKey;

            document.getElementById('swapModal').classList.add('show');
        }

        function selectSwapItem(idx) {
            // å–æ¶ˆä¹‹å‰çš„é€‰æ‹©
            document.querySelectorAll('.swap-item').forEach(item => {
                item.classList.remove('selected');
            });
            // é€‰ä¸­å½“å‰
            const items = document.querySelectorAll('.swap-item');
            if (items[idx]) {
                items[idx].classList.add('selected');
                selectedSwapIndex = idx;
                document.getElementById('swapConfirmBtn').disabled = false;
            }
        }

        function closeSwapModal() {
            document.getElementById('swapModal').classList.remove('show');
            pendingSwapRecipe = null;
            pendingSwapTypeKey = null;
            selectedSwapIndex = -1;
        }

        function confirmSwap() {
            if (selectedSwapIndex < 0) return;

            const typeMap = {
                'å‡‰èœ': 'cold', 'çƒ­èœ': 'hot', 'æ±¤': 'soup', 'ä¸»é£Ÿ': 'staple',
                'è¤ç±»': 'meat', 'ç´ ç±»': 'veg', 'å‰èœ': 'appetizer', 'ä¸»èœ': 'main', 'å°é£Ÿ': 'side', 'ç”œç‚¹': 'dessert'
            };
            const typeKey = typeMap[pendingSwapRecipe.catName];

            // è·å–åŒç±»å‹å·²åŠ å…¥çš„èœ
            const sameTypeMenu = window.myMenu.filter(m => {
                if (typeMap[m.catName] === typeKey) return true;
                if (m.cat === typeKey) return true;
                return false;
            });

            // æ‰¾åˆ°è¦æ¢æ‰çš„èœçš„ç´¢å¼•ï¼ˆåœ¨åŸmyMenuä¸­çš„ç´¢å¼•ï¼‰
            const removeIndex = window.myMenu.findIndex(m => m.n === sameTypeMenu[selectedSwapIndex].n);
            if (removeIndex < 0) return;

            // ç§»é™¤æ—§èœï¼ŒåŠ å…¥æ–°èœ
            window.myMenu.splice(removeIndex, 1);

            // æ‰¾åˆ°æ–°èœçš„å®Œæ•´ä¿¡æ¯
            let newRecipe = null;
            for (const catName in window.menuGroups) {
                const found = window.menuGroups[catName].find(m => m.n === pendingSwapRecipe.name);
                if (found) {
                    newRecipe = found;
                    break;
                }
            }

            if (newRecipe) {
                window.myMenu.push(newRecipe);
            }

            closeSwapModal();
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            updateAllButtonStates();
            updateMyMenuCount();
        }

        // ç¬¬å››é¡µï¼šå¤‡èœæ¸…å•é¡µé¢
        function goToPrepPage() {
            if (!window.myMenu || window.myMenu.length === 0) {
                alert('è¯·å…ˆæ·»åŠ èœå“åˆ°æˆ‘çš„èœå•');
                return;
            }
            renderPrepPage();
            document.getElementById('prepPage').classList.add('show');
        }

        function closePrepPage() {
            document.getElementById('prepPage').classList.remove('show');
        }

        function renderPrepPage() {
            // è®¡ç®—è´­èœæ¸…å•å’Œè°ƒæ–™æ¸…å•
            const ingredientMap = {};
            const seasoningMap = {};

            window.myMenu.forEach(r => {
                r.i.forEach(item => {
                    const name = item.n;
                    const isSeasoning = ['ç›','ç³–','é…±æ²¹','é†‹','é¦™æ²¹','èƒ¡æ¤’','å­œç„¶','è¾£æ¤’','èŠ±æ¤’','è’œ','å§œ','è‘±','æ–™é…’','èšæ²¹','ç•ªèŒ„é…±','æ²™æ‹‰é…±','é»„æ²¹','æ©„æ¦„æ²¹','æ¤°æµ†','å†¬é˜´åŠŸé…±','ç»¿å’–å–±é…±','çº¢å’–å–±é…±','æ²™å—²é…±','é±¼éœ²','é¦™èŒ…','è–„è·','æ¬§èŠ¹','è¿·è¿­é¦™','èŠå£«','å¥¶é…ª','å¥¶æ²¹','ç‰›å¥¶','é¢ç²‰','é¢åŒ…ç³ ','æ·€ç²‰','å‰åˆ—ä¸','æµ“ç¼©å’–å•¡'].some(s => name.includes(s));

                    if (isSeasoning) {
                        if (!seasoningMap[name]) seasoningMap[name] = {count: 0};
                        seasoningMap[name].count++;
                    } else {
                        if (!ingredientMap[name]) ingredientMap[name] = {amount: item.a, price: 0, isMain: ['è‚‰','é¸¡','ç‰›','ç¾Š','çŒª','è™¾','é±¼','è›‹','è±†è…','èœ','èœå¿ƒ','ç”Ÿèœ','åœŸè±†','ç•ªèŒ„','é»„ç“œ','æœ¨è€³','è—•'].some(m => name.includes(m))};
                        ingredientMap[name].price += item.p;
                    }
                });
            });

            const sortedIngredients = Object.entries(ingredientMap)
                .sort((a, b) => {
                    if (a[1].isMain && !b[1].isMain) return -1;
                    if (!a[1].isMain && b[1].isMain) return 1;
                    return b[1].price - a[1].price;
                });
            const sortedSeasonings = Object.entries(seasoningMap)
                .sort((a, b) => b[1].count - a[1].count);
            const totalAmount = sortedIngredients.reduce((sum, [_, data]) => sum + data.price, 0);

            // è´­èœæ¸…å•
            let shopHtml = '';
            if (sortedIngredients.length > 0) {
                shopHtml = `<h3 class="result-group-title">ğŸ›’ è´­èœæ¸…å•</h3>`;
                shopHtml += `<div class="detail-shop-list">`;
                sortedIngredients.forEach(([name, data]) => {
                    shopHtml += `<div class="prep-shop-item"><span class="prep-shop-name">${name}</span><div class="prep-shop-right"><span class="prep-shop-amount">${data.amount}</span><span class="prep-shop-price">Â¥${data.price.toFixed(1)}</span></div></div>`;
                });
                shopHtml += `</div>`;
            }

            // è°ƒæ–™æ¸…å•
            let seasoningHtml = '';
            if (sortedSeasonings.length > 0) {
                seasoningHtml = `<h3 class="result-group-title">ğŸ§‚ è°ƒæ–™æ¸…å•</h3>`;
                seasoningHtml += `<div style="margin-bottom:12px;">`;
                sortedSeasonings.forEach(([name, data]) => {
                    seasoningHtml += `<span class="prep-seasoning-tag">${name}</span>`;
                });
                seasoningHtml += `</div>`;
            }

            // é¢„ä¼°æ€»é‡‘é¢ï¼ˆæ”¾åœ¨è°ƒæ–™æ¸…å•ä¸‹é¢ï¼‰
            let totalHtml = '';
            if (sortedIngredients.length > 0) {
                totalHtml = `<div class="my-menu-total">é¢„ä¼°æ€»é‡‘é¢ï¼š<span>Â¥${totalAmount.toFixed(1)}</span></div>`;
            }

            document.getElementById('prepContent').innerHTML = shopHtml + seasoningHtml + totalHtml;
            document.getElementById('prepTotal').innerHTML = '';
        }

        document.getElementById('swapModal').addEventListener('click', e => {
            if(e.target.id === 'swapModal') closeSwapModal();
        });
    </script>

    <!-- æ¢èœå¼¹çª— -->
    <div class="swap-modal" id="swapModal">
        <div class="swap-content">
            <div class="swap-header">
                <button class="swap-close" onclick="closeSwapModal()">Ã—</button>
            </div>
            <div class="swap-body">
                <div class="swap-tip">ç‚¹å‡»é€‰æ‹©è¦æ¢æ‰çš„èœ</div>
                <div id="swapList"></div>
            </div>
            <div class="swap-btns">
                <button class="swap-btn cancel" onclick="closeSwapModal()">å–æ¶ˆ</button>
                <button class="swap-btn confirm" id="swapConfirmBtn" onclick="confirmSwap()" disabled>ç¡®å®š</button>
            </div>
        </div>
    </div>
</body>
</html>
